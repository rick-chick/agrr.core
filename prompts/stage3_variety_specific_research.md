# Step 3: 栽培期間別要件詳細化・構造化プロンプト

## プロンプトテンプレート

```
【{期間名}の詳細要件調査・構造化】

対象: {作物名} {品種名}

以下の栽培期間について詳細要件を調査し、JSON形式で出力してください：

### 対象期間
- **期間名**: {具体的な期間名}
- **特徴**: {具体的な特徴}

### 調査項目
以下の項目について品種の育成背景、遺伝的特性、栽培特性を学術論文や品種登録情報から詳細に調査してください：

**【重要な調査方針】**
- **最低限界温度（base_temperature）の決定**: 
  - 複数の文献を必ず参照し、報告されている値の中で**最も低い値**を採用すること
  - 「安全側」の高めの値ではなく、生理学的実証データを優先すること
  - GDD計算の精度を高めるため、より厳密な下限値が必要

#### 1. 温度要件
- **最適温度範囲（optimal_min, optimal_max）**: 最適な生育が期待できる温度範囲
  - 定義：この範囲内で最も良好な生育が見られる温度帯
- **最低限界温度（base_temperature）**: 生育が開始される最低温度（生育ゼロ点）
  - 定義：この温度以下では積算温度を加算しない（有効積算温度がゼロ）
  - GDD（生育度日）計算の基準点として使用される
  - 注意：base_temperature < low_stress_threshold < optimal_min の関係が成り立つこと
- **低温ストレス閾値（low_stress_threshold）**: 生育阻害を受ける最低温度
  - 定義：最低限界温度より高いが、生育に悪影響が出始める温度
  - 通常、最適温度範囲の下限よりも低い値
- **高温ストレス閾値（high_stress_threshold）**: 生育阻害を受ける最高温度
  - 定義：生育に悪影響が出始める高温側の温度
  - 通常、最適温度範囲の上限よりも高い値
- **最高限界温度（max_temperature）**: 発育が停止する最高温度（発育停止温度）
  - 定義：この温度以上では発育が完全に停止する（積算温度がゼロ）
  - 生理学的限界温度（酵素活性の失活、細胞膜損傷の開始温度）
  - 推定方法：文献に明示的な記載がない場合は、以下の作物分類に基づき推定：
    - イネ・穀物類：high_stress_threshold + 7°C（例：35 + 7 = 42°C）
    - 小麦類：high_stress_threshold + 5°C（例：30 + 5 = 35°C）
    - 野菜類（トマト・ナス・ピーマン等）：high_stress_threshold + 3°C（例：32 + 3 = 35°C）
    - 一般作物：high_stress_threshold + 6°C
  - 注意：base_temperature < optimal_min <= optimal_max < max_temperature の関係が成り立つこと
- **霜害リスク温度（frost_threshold）**: 霜害を受ける危険温度
  - 定義：凍害により組織が損傷する温度
- **高温障害（sterility_risk_threshold）**: 不稔リスク温度（開花・結実期を含む期間の場合）
  - 定義：高温により受粉・受精が阻害される危険温度
  - 該当しない期間ではnullを設定

#### 2. 日照要件
- **最低日照時間**: 生育に必要な最低日照時間（時間）
- **目標日照時間**: 最適な生育のための目標日照時間（時間）

#### 3. 積算温度（GDD: Growing Degree Days）

##### 3.1 基本概念
- **必要積算温度（required_gdd）**: 日平均気温から最低限界温度を引いた値の累積（°C・日）
  - 計算式：GDD = Σ(日平均気温 - 最低限界温度)
  - 説明：各栽培期間に必要な熱エネルギーの総量
  - 注意：日平均気温が最低限界温度以下の場合は0とする
  - **収穫期の場合の特記事項**：
    - 収穫期間の長さ（日数）を文献から調査すること
    - 連続収穫型作物と一斉収穫型作物では期間が大きく異なることに注意
    - required_gddは収穫期全体の期間に対応する値を設定

##### 3.2 初回収穫までの積算温度
- **初回収穫までの積算温度（harvest_start_gdd）**: 当該栽培期間の開始日から初回収穫が可能になるまでに必要な積算温度（°C・日）
  - **重要**: 期間名に「収穫」という文字が含まれない場合は必ずnullを設定すること
  - 定義：
    - 起点：当該栽培期間（収穫期）の開始日
    - 終点：初回収穫が可能になる日
    - 計算：期間開始日から初回収穫日までの各日の（日平均気温 - 最低限界温度）の累積値
  - 適用条件：
    - **期間名に「収穫」という文字が含まれ、かつ連続収穫が可能な作物の場合のみ設定**
    - 育苗期、定植期、生育期、開花期などの収穫期以外のステージでは必ずnullを設定
    - 一斉収穫型の作物の収穫期でもnullを設定
  - **調査時の注意点**：
    - 収穫期全体の期間（日数）を文献から調査すること
    - 初回収穫までの期間（日数）を文献から調査すること
    - harvest_start_gddは初回収穫までの期間に対応する値を設定
  - 制約：harvest_start_gdd < required_gdd
    - required_gdd：当該栽培期間（収穫期）全体に必要な積算温度
    - harvest_start_gdd：収穫期内で初回収穫までに必要な部分的な積算温度
    - 両者の差分が収穫継続期間を表す
    - 連続収穫型作物では初回収穫後も一定期間収穫が継続することを考慮

### 出力形式（JSON）
以下のJSON形式で出力してください：

```json
{
  "temperature": {
    "base_temperature": 0.0,
    "optimal_min": 0.0,
    "optimal_max": 0.0,
    "low_stress_threshold": 0.0,
    "high_stress_threshold": 0.0,
    "frost_threshold": 0.0,
    "sterility_risk_threshold": null,
    "max_temperature": 0.0
  },
  "sunshine": {
    "minimum_sunshine_hours": 0.0,
    "target_sunshine_hours": 0.0
  },
  "thermal": {
    "required_gdd": 0.0,
    "harvest_start_gdd": null
  }
}
```

**注意**: 上記の0.0は書式を示すためのプレースホルダーです。実際には、以下の手順で値を設定してください：
1. 学術論文や品種登録情報から各項目の実際の値を調査
2. 品種の遺伝的特性や栽培特性に基づいて適切な数値を設定
3. 不明な項目はnullを使用


### 日照時間設定の調査方針
日照時間要件については、以下の学術的な情報源から調査してください：

- **学術論文・研究報告**: 対象品種または同種作物の光合成特性、光飽和点、補償点に関する研究データ
- **品種登録情報**: 品種特性として記載されている日照要件や栽培環境条件
- **栽培生理学的知見**: 作物分類（果菜類・葉菜類・根菜類等）に基づく光要求特性の違い
- **実験データ**: 遮光処理試験や日照時間と生育・収量の関係を調査した研究結果

**調査時の注意点**:
- 品種固有の特性を最優先とすること
- 複数の文献で報告されている値がある場合は、その範囲を考慮すること
- 栽培期間ごとに光要求が異なる場合は、該当期間の値を採用すること
- 明確なデータが見つからない場合は、近縁品種や同じ作物分類の標準値を参考にすること

### 注意事項
- 指定された栽培期間に特化した調査
- 品種の育成背景、遺伝的特性、栽培特性を学術論文や品種登録情報から詳細に調査
- 地域や栽培方式は考慮しない
- 学術的な根拠に基づいて推定値を設定
- 開花・結実期を含む期間では高温障害の閾値を必ず設定し、その他の特殊要件も明記
- **収穫期の積算温度算出**：
  - 収穫期間の長さ（日数）を文献から調査し、その期間に対応するrequired_gddを設定すること
  - 作物によって収穫期間は数日から数ヶ月まで大きく異なることを認識すること
  - 初回収穫までの期間と収穫期全体の期間を明確に区別すること
- **harvest_start_gddは期間名に「収穫」という文字が含まれ、かつ連続収穫型作物の場合のみ設定し、それ以外は必ずnullとすること**
- 有効なJSON形式で出力し、数値は小数点以下1桁まで
- 不明な項目はnullを設定
- 出力前にJSON形式の妥当性を確認すること
```

## 使用例

### 例1: 作物A 品種X - 第1期間
```
【第1期間の詳細要件調査・構造化】

対象: 作物A 品種X

以下の栽培期間について詳細要件を調査し、JSON形式で出力してください：

### 対象期間
- **期間名**: 第1期間
- **特徴**: （期間の特徴）

[上記テンプレート内容]
```

### 例2: 作物B 品種Y - 第2期間
```
【第2期間の詳細要件調査・構造化】

対象: 作物B 品種Y

以下の栽培期間について詳細要件を調査し、JSON形式で出力してください：

### 対象期間
- **期間名**: 第2期間
- **特徴**: （期間の特徴）

[上記テンプレート内容]
```
