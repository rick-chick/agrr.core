# 生育要件調査プロセスフロー

## 概要

このプロセスは、作物の品種固有の生育要件を段階的に調査し、最終的に構造化されたJSONデータを生成するためのフローです。

## フロー構成

### Step 1: 品種選択
**目的**: 調査対象の作物と品種を決定

**入力**: ユーザーによる品種指定
**出力**: 作物名と品種名

**例**:
```
入力: "作物名 品種名"
出力: {"crop_name": "作物名", "variety": "品種名"}
```

### Step 2: 成長ステージ定義
**目的**: 対象品種の成長ステージを定義

**入力**: Step 1の出力（作物名と品種名）
**出力**: 成長ステージの定義（JSON形式）

**出力形式**:
```json
{
  "crop_info": {
    "name": "作物名",
    "variety": "品種名"
  },
  "growth_stages": [
    {
      "stage_name": "播種～育苗完了",
      "description": "発芽から本葉5-6枚まで、定植適期"
    },
    {
      "stage_name": "育苗～開花",
      "description": "定植から第1花房開花まで"
    },
    {
      "stage_name": "開花～収穫",
      "description": "第1花房開花から収穫完了まで"
    }
  ]
}
```

### Step 3: 品種固有要件調査・構造化
**目的**: 各成長ステージの詳細要件を調査し、JSON形式で出力

**入力**: Step 2の出力（成長ステージ定義）
**処理**: 各ステージごとに個別実行
**出力**: 各ステージの詳細要件（JSON形式）

**出力形式**:
```json
{
  "stage_name": "播種～育苗完了",
  "order": 1,
  "temperature": {
    "base_temperature": 0.0,
    "optimal_min": 0.0,
    "optimal_max": 0.0,
    "low_stress_threshold": 0.0,
    "high_stress_threshold": 0.0,
    "frost_threshold": 0.0,
    "sterility_risk_threshold": null
  },
  "sunshine": {
    "minimum_sunshine_hours": 0.0,
    "target_sunshine_hours": 0.0
  },
  "thermal": {
    "required_gdd": 0.0
  }
}
```

**注意**: 上記の0.0は書式を示すプレースホルダーです。実際の値は学術的根拠に基づいて設定してください。

## データフロー

```
Step 1 (品種選択)
    ↓
Step 2 (成長ステージ定義) → JSON出力
    ↓ (各ステージごとに分割)
Step 3 (要件調査・構造化) → JSON出力 (ステージ数分)
    ↓ (統合)
最終出力 (全ステージの統合JSON)
```

## 実行方法

### 個別ステップ実行
1. **Step 2実行**: 全ステージを一括で定義
2. **Step 3実行**: 各ステージごとに個別実行
   - ステージ1の要件調査
   - ステージ2の要件調査  
   - ステージ3の要件調査
3. **結果統合**: 全ステージの結果を統合

### データ変換処理
```
Step 2出力 (JSON) → Step 3入力 (テキストプロンプト)
Step 3出力 (JSON) → 最終統合 (JSON)
```

## 特徴

### 1. 段階的調査
- 各ステップが明確な責任を持つ
- 前のステップの結果を次のステップで活用

### 2. 個別ステージ処理
- 各成長ステージを詳細に調査
- 品種固有の特性を正確に反映

### 3. 構造化出力
- 最終的にJSON形式で出力
- プログラムでの利用に適した形式

### 4. エラーハンドリング
- 各ステップでの入力検証
- 個別ステージの失敗時の処理

## 利点

1. **正確性**: 各ステージを個別に詳細調査
2. **柔軟性**: ステージ数の変更に対応可能
3. **再利用性**: JSON形式での出力により再利用可能
4. **保守性**: 各ステップが独立しているため保守しやすい

## 注意事項

1. **データ変換**: Step 2からStep 3への変換処理が必要
2. **実行時間**: ステージ数に比例して実行時間が増加
3. **エラー処理**: 個別ステージの失敗時の適切な処理が必要
4. **結果統合**: 複数のStep 3結果を適切に統合する必要がある
