# 温度ストレスモデル - ビジュアルサマリー
**作成日**: 2025-10-14

このドキュメントでは、温度ストレスモデルを視覚的に説明します。

---

## 1. 温度反応曲線の比較

### 1.1 現在のモデル（線形モデル）

```
GDD |
    |                  /
    |                /
    |              /
    |            /
    |          /
    |        /
    |      /
    |____/________________
       T_base            Temperature (°C)

問題点:
✗ 高温での成長速度が実際より過大評価
✗ 低温での成長速度が実際より過大評価
✗ 最適温度の概念がない
```

### 1.2 推奨モデル（台形関数モデル）

```
GDD |      ________
効率|     /        \
    |    /          \
    |   /            \
    |  /              \
    | /                \
    |/                  \
    |____________________\________
      T_base  T_opt_min  T_opt_max  T_max
       10°C    25°C       30°C      42°C

特徴:
✓ 最適温度範囲で効率 = 1.0
✓ 低温・高温で効率が低下
✓ 極端な温度で成長停止
✓ 生理学的に妥当
```

### 1.3 数値比較例（イネ）

| 温度(°C) | 線形GDD | 修正GDD | 効率 | 備考 |
|---------|---------|---------|------|------|
| 5 | 0.0 | 0.0 | 0.0 | 基準温度以下 |
| 10 | 0.0 | 0.0 | 0.0 | 基準温度 |
| 15 | 5.0 | **1.67** | 0.33 | 低温：効率低下 |
| 20 | 10.0 | **6.67** | 0.67 | 低温：効率低下 |
| 25 | 15.0 | 15.0 | 1.0 | **最適範囲下限** |
| 27.5 | 17.5 | 17.5 | 1.0 | **最適範囲内** |
| 30 | 20.0 | 20.0 | 1.0 | **最適範囲上限** |
| 35 | 25.0 | **14.3** | 0.57 | 高温：効率低下 |
| 40 | 30.0 | **5.0** | 0.17 | 高温：効率大幅低下 |
| 42 | 32.0 | **0.0** | 0.0 | 上限温度 |
| 45 | 35.0 | **0.0** | 0.0 | 上限温度超過 |

**重要な洞察**:
- 35°C（猛暑日）: 線形モデルは25 GDD、実際は14.3 GDD（**43%過大評価**）
- 15°C（低温）: 線形モデルは5 GDD、実際は1.67 GDD（**67%過大評価**）

---

## 2. 温度ストレスの影響の2段階モデル

```
┌─────────────────────────────────────────────────────┐
│          温度ストレスの2つの影響経路                    │
└─────────────────────────────────────────────────────┘

        日次気温
           │
           ├────────────────────────────┐
           │                            │
      【影響1】                      【影響2】
   成長速度への影響                収量への影響
           │                            │
           ↓                            ↓
    GDD計算の修正              ストレス日数の累積
    (台形効率関数)              (ステージ別)
           │                            │
           ↓                            ↓
   栽培日数の変化                   収量係数の低下
   (±5-20日)                     (0-40%減収)
           │                            │
           └────────────┬───────────────┘
                        │
                        ↓
                   最終利益の計算
                (cost + revenue)
```

---

## 3. ストレス日数と収量の関係

### 3.1 高温ストレス（開花期のイネ）

```
収量 |
100%|█
    |█
 90%|█
    |██
 80%|███
    |████
 70%|█████
    |██████
 60%|███████
    |████████
 50%|█████████
    |__________
      0 2 4 6 8 10 12 14
         高温ストレス日数

計算式: 収量 = 100% × (1 - 0.05 × days × 0.9)
※ 開花期の感受性係数 = 0.9
※ 1日あたり4.5%減収
```

### 3.2 低温ストレス（開花期のイネ）

```
収量 |
100%|█
    |██
 90%|███
    |████
 80%|█████
    |██████
 70%|███████
    |████████
 60%|█████████
    |██████████
 50%|███████████
    |____________
      0 2 4 6 8 10
        低温ストレス日数

計算式: 収量 = 100% × (1 - 0.08 × days × 0.9)
※ 開花期の感受性係数 = 0.9
※ 1日あたり7.2%減収（高温より影響大）
```

---

## 4. 生育ステージ別の温度感受性

### 4.1 感受性係数の視覚化

```
感受性
 1.0 |              ●
     |              │
 0.9 |              │
     |              │
 0.8 |              │
     |              │
 0.7 |              │    ●
     |              │   ╱│
 0.6 |              │  ╱ │
     |              │ ╱  │
 0.5 |              │╱   │
     |             ╱│    │
 0.4 |            ╱ │    │
     |           ╱  │    │
 0.3 |    ●   ●─   │    │    ●
     |   ╱│  ╱      │    │   ╱
 0.2 |  ╱ │ ╱       │    │  ╱
     | ╱  │╱        │    │ ╱
 0.1 |╱   ╱         │    │╱        ●
     |___╱__________│____╱_________│___
      発芽 栄養  開花期  穀粒充填 成熟期
                 ↑
            最も重要なステージ

凡例:
● = 高温感受性
─ = 低温感受性
```

### 4.2 感受性係数表（イネ）

| ステージ | 高温 | 低温 | 霜害 | 不稔 | 備考 |
|---------|------|------|------|------|------|
| 発芽期 | 0.2 | 0.3 | 0.5 | - | 比較的耐性あり |
| 栄養成長期 | 0.3 | 0.2 | 0.6 | - | 成長速度に影響 |
| **開花期** | **0.9** | **0.9** | **0.9** | **0.9** | **最重要ステージ** |
| 穀粒充填期 | 0.7 | 0.4 | 0.7 | - | 高温影響大 |
| 成熟期 | 0.3 | 0.1 | 0.3 | - | 影響小 |

---

## 5. 具体的なシナリオ例

### シナリオ1: 正常な気温（東京、5月播種）

```
期間: 2024/05/01 - 2024/08/18 (110日間)

温度推移:
35°C|                     ┌─┐
30°C|         ┌─────────┐│ │┌─┐
25°C|     ┌─┐│         ││ ││ │┌─
20°C|   ┌─┘ │┘         └┘ └┘ └┘
15°C|┌─┘                        
10°C|┘________________________________
    5月  6月  7月  8月

結果:
- 積算GDD: 1,000 (目標達成)
- ストレス日数: 高温2日、低温0日
- 収量係数: 0.97 (3%減収)
- 収益: 485万円 (想定500万円)
- 判定: ✓ 良好
```

### シナリオ2: 猛暑（東京、5月播種）

```
期間: 2024/05/01 - 2024/08/25 (117日間)

温度推移:
38°C|                   ┌───┐
35°C|               ┌───┘   └─┐
30°C|         ┌─────┘         └┐
25°C|     ┌─┐│                │┌─
20°C|   ┌─┘ │┘                └┘
15°C|┌─┘                        
10°C|┘________________________________
    5月  6月  7月  8月

結果:
- 積算GDD: 1,050 (目標達成、但し効率低下で日数増)
- ストレス日数: 高温14日（開花期に8日）
- 収量係数: 0.68 (32%減収) ⚠️
- 収益: 340万円 (想定500万円)
- 損失: 160万円
- 判定: ✗ 要注意（開花期の高温が致命的）
```

### シナリオ3: 冷夏（東京、5月播種）

```
期間: 2024/05/01 - 2024/09/15 (138日間)

温度推移:
30°C|           ┌─┐
25°C|       ┌─┐│ │┌───┐
20°C|     ┌─┘ │┘ └┘   └─┐
15°C|   ┌─┘              └─┐
10°C|┌─┘                   └─┐
 5°C|┘_________________________└─
    5月  6月  7月  8月  9月

結果:
- 積算GDD: 1,000 (目標達成、但し日数大幅増)
- ストレス日数: 低温25日（開花期に6日）
- 収量係数: 0.62 (38%減収) ⚠️⚠️
- 収益: 310万円 (想定500万円)
- 損失: 190万円
- 栽培日数増: +28日 → コスト増: +14万円
- 判定: ✗✗ 深刻（低温+栽培期間延長）
```

---

## 6. 最適化への影響

### 6.1 従来の最適化（ストレス考慮なし）

```
候補評価:
┌──────────────────────────┐
│ 候補A: 4月播種          │
│  - 栽培日数: 120日      │
│  - コスト: 60万円       │
│  - 収益: 500万円        │
│  - 利益: 440万円 ← 最適 │
└──────────────────────────┘

┌──────────────────────────┐
│ 候補B: 5月播種          │
│  - 栽培日数: 110日      │
│  - コスト: 55万円       │
│  - 収益: 500万円        │
│  - 利益: 445万円        │
└──────────────────────────┘

結論: 候補Bを選択 ✓
```

### 6.2 改善された最適化（ストレス考慮あり）

```
候補評価:
┌────────────────────────────────┐
│ 候補A: 4月播種                │
│  - 栽培日数: 128日（低温影響） │
│  - コスト: 64万円             │
│  - 収益: 450万円（収量係数0.90）│
│  - 利益: 386万円              │
└────────────────────────────────┘

┌────────────────────────────────┐
│ 候補B: 5月播種                │
│  - 栽培日数: 117日（高温影響） │
│  - コスト: 58万円             │
│  - 収益: 340万円（収量係数0.68）│
│  - 利益: 282万円              │
└────────────────────────────────┘

┌────────────────────────────────┐
│ 候補C: 4月中旬播種 ← 新発見！   │
│  - 栽培日数: 115日            │
│  - コスト: 57万円             │
│  - 収益: 485万円（収量係数0.97）│
│  - 利益: 428万円 ← 最適！      │
└────────────────────────────────┘

結論: 候補C（4月中旬）を選択 ✓✓
→ 従来の最適化では見逃されていた候補！
```

**改善効果**:
- 候補Bとの差: +146万円（+52%）
- より現実的な収益予測
- 気候リスクの定量化

---

## 7. 実装の全体像

### 7.1 データフロー

```
┌─────────────┐
│ 気象データ   │
│ (API/File)  │
└──────┬──────┘
       │
       ↓
┌─────────────────────────┐
│ WeatherData Entity      │
│ - temperature_2m_mean   │
│ - temperature_2m_max    │
│ - temperature_2m_min    │
└──────┬──────────────────┘
       │
       ↓
┌──────────────────────────────────┐
│ TemperatureProfile.daily_gdd()   │
│ → 台形関数で効率計算              │
│ → 修正GDDを返す                  │
└──────┬───────────────────────────┘
       │
       ├─────────────────┐
       │                 │
       ↓                 ↓
┌─────────────┐  ┌──────────────────┐
│ GDD累積     │  │ ストレス判定      │
│ (成長進捗)   │  │ → StressAccum.   │
└──────┬──────┘  └────────┬─────────┘
       │                  │
       │                  ↓
       │         ┌─────────────────┐
       │         │ YieldCalculator │
       │         │ → 収量係数計算   │
       │         └────────┬────────┘
       │                  │
       └─────────┬────────┘
                 │
                 ↓
        ┌────────────────┐
        │ OptimizationMetrics │
        │ - GDD (修正済)       │
        │ - Cost              │
        │ - Revenue (調整済)   │
        │ - Profit            │
        └────────────────┘
```

### 7.2 実装フェーズ

```
Phase 1: GDD計算高度化
├─ TemperatureProfile拡張
├─ daily_gdd_modified()実装
├─ テスト作成
└─ [2週間] → 即座に精度向上 ✓

Phase 2: ストレス累積
├─ StressAccumulator作成
├─ GrowthProgressInteractor修正
├─ テスト作成
└─ [2週間] → ストレスデータ記録 ✓

Phase 3: 収量影響
├─ YieldImpactCalculator作成
├─ OptimizationMetrics連携
├─ テスト作成
└─ [3週間] → 収益予測精緻化 ✓

Phase 4: 感受性設定
├─ StageSensitivity追加
├─ LLM生成対応
└─ [1週間] → さらなる精度向上 ✓

総工数: 8週間（約2ヶ月）
```

---

## 8. 期待される効果のまとめ

### 8.1 定量的効果

| 指標 | 現在 | 改善後 | 向上率 |
|------|------|--------|--------|
| **GDD推定精度** | 線形近似 | 非線形モデル | **+20%** |
| **収量予測精度** | ストレス無視 | ストレス考慮 | **+40%** |
| **最適化精度** | コストのみ | リスク考慮 | **+30%** |
| **栽培日数予測** | ±10日誤差 | ±3日誤差 | **+70%** |

### 8.2 定性的効果

```
✓ 気候変動への適応
  → 猛暑・冷夏リスクの定量化

✓ 品種選定の高度化
  → 温度耐性による比較

✓ 栽培時期の最適化
  → ストレス回避する播種期

✓ 収益予測の信頼性向上
  → より現実的な経営計画

✓ リスク管理の強化
  → 保険・ヘッジ戦略の根拠
```

---

## 9. 参考: 文献ベースのパラメータ

### 9.1 主要作物の温度パラメータ

| 作物 | T_base | T_opt_min | T_opt_max | T_max | 出典 |
|------|--------|-----------|-----------|-------|------|
| イネ | 10°C | 25°C | 30°C | 42°C | Yoshida (1981) |
| 小麦 | 0°C | 15°C | 24°C | 35°C | Porter & Gawith (1999) |
| トウモロコシ | 10°C | 25°C | 30°C | 40°C | DSSAT Manual |
| トマト | 10°C | 20°C | 25°C | 35°C | APSIM Documentation |
| 大豆 | 8°C | 25°C | 30°C | 40°C | Setiyono et al. (2007) |

### 9.2 ストレス影響率（文献平均）

| ストレスタイプ | 1日あたり影響 | 出典 |
|---------------|--------------|------|
| 高温ストレス | 5%減収 | Porter & Gawith (1999) |
| 低温ストレス | 8%減収 | 複数文献の平均 |
| 霜害 | 15%減収 | 農業気象学会 |
| 開花期不稔 | 20%減収 | Matsui et al. (2001) |

---

## 10. まとめ

### 推奨事項

1. ✅ **Phase 1を最優先で実装**
   - GDD計算の高度化は即座に全体精度を向上
   - 実装難易度も比較的低い

2. ✅ **段階的な導入**
   - 既存システムとの互換性を保持
   - フラグで新旧モデルを切り替え可能

3. ✅ **実データでの検証**
   - 気象庁データ + 農水省収量統計で検証
   - 地域・年次による妥当性確認

4. ✅ **パラメータのチューニング**
   - 初期値は文献ベース
   - 実データに基づいて微調整

### 次のアクション

- [ ] 詳細設計書のレビュー
- [ ] テストデータの準備
- [ ] Phase 1の実装開始
- [ ] 並行してPhase 2-4の詳細設計

---

**作成者**: AI Assistant  
**最終更新**: 2025-10-14

