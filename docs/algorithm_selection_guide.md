# アルゴリズム選択ガイド

## クイック意思決定フローチャート

```
START
  |
  ├─ 厳密な最適解が必須か？
  |   YES → 予算はあるか？
  |           YES → [MILP (Gurobi/CPLEX)]
  |           NO  → 問題サイズは小さいか？
  |                   YES → [動的計画法]
  |                   NO  → [MILP (PuLP/CBC)] + 時間制限
  |
  NO → 計算時間に制約があるか？
        |
        YES → 1秒以内が必要か？
        |       YES → [貪欲法のみ]
        |       NO  → 30秒以内で良いか？
        |               YES → [貪欲法 + 局所探索] ★推奨
        |               NO  → [焼きなまし法]
        |
        NO → 問題の特性は？
              |
              ├─ 非線形・複雑な評価関数
              |   → [遺伝的アルゴリズム]
              |
              ├─ 並列計算可能
              |   → [遺伝的アルゴリズム(並列)]
              |
              └─ 標準的な問題
                  → [貪欲法 + 局所探索] ★推奨
```

## ユースケース別の推奨アルゴリズム

### Case 1: スタートアップ・MVP開発

**状況**:
- 予算が限られている
- 早くリリースしたい
- とりあえず動くものが欲しい

**推奨**: **貪欲法**
```
理由:
  ✓ 実装が最も簡単（1週間）
  ✓ 計算が高速（< 1秒）
  ✓ 十分な品質（最適解の70-85%）

実装工数: 1-2週間
品質: ★★★☆☆
速度: ★★★★★
```

### Case 2: 一般的な中小規模農家向けシステム

**状況**:
- 圃場: 3-20個
- 作物: 2-10種類
- ユーザーは品質重視

**推奨**: **貪欲法 + 局所探索** ★★★★★
```
理由:
  ✓ バランスが最も良い
  ✓ 実用的な計算時間（5-30秒）
  ✓ 高品質な解（最適解の85-95%）
  ✓ 段階的実装可能

実装工数: 2-4週間
品質: ★★★★☆
速度: ★★★★☆
```

### Case 3: 大規模農業法人向けシステム

**状況**:
- 圃場: 50個以上
- 作物: 20種類以上
- 厳密な最適化が必要

**推奨**: **MILP (商用ソルバー)**
```
理由:
  ✓ 大規模問題に対応
  ✓ 厳密な最適解
  ✓ 複雑な制約を自然に表現

実装工数: 4-8週間
品質: ★★★★★
速度: ★★★☆☆
コスト: 高（年間数十万円のライセンス）
```

### Case 4: 研究・学術用途

**状況**:
- 厳密な最適解が必要
- 計算時間は問わない
- 小規模問題（実験用）

**推奨**: **動的計画法**
```
理由:
  ✓ 厳密な最適解を保証
  ✓ アルゴリズムが明確
  ✓ 既存実装を活用可能

実装工数: 2-3週間
品質: ★★★★★
速度: ★★☆☆☆（小規模のみ）
```

### Case 5: リアルタイム意思決定支援

**状況**:
- ユーザーが待てない（< 1秒）
- 対話的なUI
- ある程度の品質で十分

**推奨**: **貪欲法**
```
理由:
  ✓ 圧倒的な速度（< 1秒）
  ✓ シンプル
  ✓ 予測可能な性能

実装工数: 1-2週間
品質: ★★★☆☆
速度: ★★★★★
```

### Case 6: 複雑な制約・非線形評価

**状況**:
- 気象リスク、市場変動などを考慮
- 評価関数が複雑
- 計算時間に余裕がある

**推奨**: **遺伝的アルゴリズム** or **焼きなまし法**
```
理由:
  ✓ 非線形問題に対応
  ✓ 柔軟な評価関数
  ✓ 局所最適を回避

実装工数: 4-6週間
品質: ★★★★☆
速度: ★★☆☆☆
```

## 問題サイズ別の推奨

### 超小規模（圃場1-3個、作物1-2種）

```
候補数: < 100

第1選択: 動的計画法
  → 厳密解が瞬時に得られる
  
第2選択: 貪欲法
  → シンプルで十分
```

### 小規模（圃場3-5個、作物2-3種）

```
候補数: 100-500

第1選択: 貪欲法 + 局所探索
  → バランスが良い
  
第2選択: 動的計画法
  → 厳密解が必要なら
```

### 中規模（圃場5-20個、作物3-10種）

```
候補数: 500-5,000

第1選択: 貪欲法 + 局所探索 ★推奨
  → 最もバランスが良い
  
第2選択: MILP (PuLP)
  → 厳密解が必要で時間に余裕があれば
```

### 大規模（圃場20-100個、作物10-50種）

```
候補数: 5,000-50,000

第1選択: MILP (商用ソルバー)
  → 予算があれば最適
  
第2選択: 貪欲法 + 局所探索
  → 予算がなければこれ
  
第3選択: 遺伝的アルゴリズム（並列化）
  → 計算資源があれば
```

### 超大規模（圃場100個以上）

```
候補数: 50,000以上

第1選択: MILP (Gurobi/CPLEX)
  → 唯一の実用的選択肢
  
第2選択: 階層的アプローチ
  → 問題を分割して解く
```

## 開発フェーズ別の推奨

### Phase 1: プロトタイプ（1-2週間）

**目標**: とにかく動くものを作る

```
アルゴリズム: 貪欲法（利益率優先）

実装内容:
  □ 候補生成ロジック
  □ 利益率計算
  □ 制約チェック（時間重複、面積）
  □ 基本的なテスト

期待品質: ★★★☆☆
```

### Phase 2: MVP（2-4週間）

**目標**: 実用的な品質を達成

```
アルゴリズム: 貪欲法 + Hill Climbing

実装内容:
  □ Phase 1の完成
  □ 近傍操作（Swap, Shift）
  □ 局所探索ループ
  □ 改善の可視化

期待品質: ★★★★☆
```

### Phase 3: プロダクション（4-8週間）

**目標**: 商用レベルの品質

```
アルゴリズム: 
  Option A: 貪欲法 + 焼きなまし法
  Option B: MILP (PuLP)

実装内容:
  □ Phase 2の完成
  □ より高度な探索
  □ パフォーマンス最適化
  □ 包括的なテスト

期待品質: ★★★★★
```

## 技術的制約による選択

### メモリが限られている（< 1GB）

```
推奨: 貪欲法 or 貪欲法+局所探索
理由: O(n)の線形メモリで済む

避けるべき: 動的計画法、遺伝的アルゴリズム
```

### 計算時間が限られている（< 10秒）

```
推奨: 貪欲法 or 貪欲法+局所探索（反復制限）
理由: 時間制御が容易

避けるべき: MILP（時間が予測困難）、遺伝的アルゴリズム
```

### 外部ライブラリが使えない

```
推奨: 貪欲法 or 動的計画法 or 局所探索
理由: ピュアPythonで実装可能

避けるべき: MILP、遺伝的アルゴリズム（ライブラリ必須）
```

### 並列計算環境がある（マルチコア、クラスタ）

```
推奨: 遺伝的アルゴリズム
理由: 並列化効率が高い

代替: 複数シナリオの並列実行
```

## コスト別の選択

### 予算: 0円（無料のみ）

```
アルゴリズム: 貪欲法 + 局所探索

ツール:
  ✓ Python標準ライブラリ
  ✓ NumPy/SciPy（オプション）
  
実装工数: 2-4週間（人件費のみ）
```

### 予算: 10-50万円

```
アルゴリズム: MILP (PuLP + CBC)

ツール:
  ✓ PuLP（無料）
  ✓ CBC（無料）
  ✓ OR-Tools（無料）
  
実装工数: 4-6週間
コンサルティング: 可能
```

### 予算: 50万円以上

```
アルゴリズム: MILP (Gurobi or CPLEX)

ツール:
  ✓ Gurobi（学術ライセンス無料、商用$10K/年）
  ✓ CPLEX（学術ライセンス無料、商用$10K/年）
  
実装工数: 4-8週間
コンサルティング: 推奨
```

## チーム能力による選択

### チーム: 1人、経験浅い

```
推奨: 貪欲法

理由:
  ✓ 実装が最も簡単
  ✓ デバッグしやすい
  ✓ 段階的に学習できる

避けるべき: MILP、遺伝的アルゴリズム
```

### チーム: 2-3人、一般的な経験

```
推奨: 貪欲法 + 局所探索 ★推奨

理由:
  ✓ 適度な難易度
  ✓ チームで分担可能
  ✓ 学習機会になる
```

### チーム: 5人以上、専門家含む

```
推奨: MILP or ハイブリッドアプローチ

理由:
  ✓ 高度な実装が可能
  ✓ 複数アルゴリズムの並行開発
  ✓ 比較評価が可能
```

## 具体的な推奨マトリクス

| 問題サイズ | 速度重視 | 品質重視 | バランス | 予算あり |
|-----------|---------|---------|---------|---------|
| **超小規模** | 貪欲法 | DP | 貪欲法+LS | DP |
| **小規模** | 貪欲法 | DP | **貪欲法+LS** | MILP |
| **中規模** | 貪欲法 | 貪欲法+LS | **貪欲法+LS** | MILP(商用) |
| **大規模** | 貪欲法 | MILP(商用) | 貪欲法+LS | MILP(商用) |
| **超大規模** | 貪欲法 | MILP(商用) | 階層的 | MILP(商用) |

**凡例**:
- DP: 動的計画法
- LS: 局所探索
- 太字: 最も推奨

## 実装の優先順位（推奨）

### 優先度: 高（必須）

```
1. 貪欲法（利益率優先）
   → まずこれで動作確認

2. 制約チェック機能
   → 時間重複、面積制約

3. 基本的なテスト
   → 小規模データでの動作確認
```

### 優先度: 中（推奨）

```
4. 局所探索（Hill Climbing）
   → Swap, Shift操作

5. 複数の貪欲戦略
   → 利益優先、制約優先など

6. パフォーマンス測定
   → 計算時間、品質の測定
```

### 優先度: 低（オプション）

```
7. 焼きなまし法
   → さらなる品質向上

8. MILP実装
   → 厳密解が必要な場合

9. 並列化
   → 大規模問題対応
```

## まとめ：アルゴリズム選択の黄金律

### 迷ったら: **貪欲法 + 局所探索**

理由：
1. ✅ 実装難易度が適度（2-4週間）
2. ✅ 計算時間が予測可能（5-30秒）
3. ✅ 品質が実用的（最適解の85-95%）
4. ✅ 段階的実装が可能
5. ✅ ほとんどの問題サイズに対応
6. ✅ 将来の拡張も容易

### 例外ケース

**貪欲法のみ**: リアルタイム応答が必須（< 1秒）
**動的計画法**: 超小規模問題で厳密解が必要
**MILP**: 大規模問題で厳密解が必要＋予算あり
**遺伝的アルゴリズム**: 非線形で複雑な評価関数

---

## クイックスタートテンプレート

実装を開始する際は、以下のテンプレートを使用してください：

```python
"""
複数圃場・複数作物の最適化
アルゴリズム: 貪欲法 + 局所探索
"""

def optimize(fields, crops, weather_data, targets):
    """
    最適化のエントリーポイント
    
    Phase 1: 候補生成
    Phase 2: 貪欲法（初期解）
    Phase 3: 局所探索（改善）
    """
    # Phase 1: 候補生成
    candidates = generate_candidates(fields, crops, weather_data)
    
    # Phase 2: 貪欲法
    initial_solution = greedy_allocation(candidates, targets)
    
    # Phase 3: 局所探索
    optimized_solution = local_search(initial_solution, max_iterations=100)
    
    return optimized_solution

# 必要に応じて段階的に拡張
```

---

このガイドを参考に、プロジェクトの要件に最適なアルゴリズムを選択してください。

