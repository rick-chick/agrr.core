# Allocation Adjust æ©Ÿèƒ½å®Ÿè£…å®Œäº†ãƒ¬ãƒãƒ¼ãƒˆ

**å®Ÿè£…æ—¥**: 2025-10-18  
**æ©Ÿèƒ½å**: `agrr optimize adjust` - ä½œç‰©é…ç½®ã®æ‰‹å‹•èª¿æ•´ã¨å†æœ€é©åŒ–  
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: âœ… **Phase 1 å®Œäº†ãƒ»Betaç‰ˆãƒªãƒªãƒ¼ã‚¹å¯**

---

## ğŸ¯ è¦ä»¶ã¨å®Ÿè£…ã‚µãƒãƒªãƒ¼

### ãƒ¦ãƒ¼ã‚¶ãƒ¼è¦ä»¶
> "æ—¢å­˜ã®ä½œç‰©ã®ã‚¢ãƒ­ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¨ã€ä»Šå›ç§»å‹•ã™ã‚‹ä½œç‰©ã¨ãã®ç§»å‹•ã‚’æŒ‡å®šã—ã¦ã€åˆ©ç›Šã®æœ€é©åŒ–ã‚’å›³ã‚Šã€ç§»å‹•çµæœã‚’è¿”ã—ãŸã„"

### å®Ÿè£…å†…å®¹
- **ã‚³ãƒãƒ³ãƒ‰**: `agrr optimize adjust`
- **å…¥åŠ›**: ç¾åœ¨ã®é…ç½®JSONã€ç§»å‹•æŒ‡ç¤ºJSONã€æ°—è±¡ãƒ‡ãƒ¼ã‚¿ã€ã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼ˆåœƒå ´/ä½œç‰©/ãƒ«ãƒ¼ãƒ«ï¼‰
- **å‡¦ç†**: ç§»å‹•é©ç”¨ â†’ å†æœ€é©åŒ– (DP/Greedy + Local Search)
- **å‡ºåŠ›**: èª¿æ•´å¾Œã®æœ€é©é…ç½® (Table/JSONå½¢å¼)
- **åˆ¶ç´„**: ä¼‘é–‘æœŸé–“ã€é€£ä½œéšœå®³ã€åœƒå ´å®¹é‡ã€è¨ˆç”»æœŸé–“

---

## ğŸ“¦ å®Ÿè£…ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆä¸€è¦§

### Entityå±¤ (4ãƒ•ã‚¡ã‚¤ãƒ«)
1. âœ… `move_instruction_entity.py` - ç§»å‹•æŒ‡ç¤ºã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£
   - MoveAction enum (MOVE/REMOVE)
   - ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å®Œå‚™
   - ã‚¤ãƒŸãƒ¥ãƒ¼ã‚¿ãƒ–ãƒ«è¨­è¨ˆ

### UseCaseå±¤ (5ãƒ•ã‚¡ã‚¤ãƒ«)
2. âœ… `allocation_adjust_request_dto.py` - ãƒªã‚¯ã‚¨ã‚¹ãƒˆDTO
3. âœ… `allocation_adjust_response_dto.py` - ãƒ¬ã‚¹ãƒãƒ³ã‚¹DTO
4. âœ… `optimization_result_gateway.py` - Gateway interface
5. âœ… `move_instruction_gateway.py` - Gateway interface
6. âœ… `allocation_adjust_interactor.py` - ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ (105è¡Œ)

### Adapterå±¤ (4ãƒ•ã‚¡ã‚¤ãƒ«)
7. âœ… `optimization_result_file_gateway.py` - JSONèª­ã¿è¾¼ã¿
8. âœ… `move_instruction_file_gateway.py` - ç§»å‹•æŒ‡ç¤ºèª­ã¿è¾¼ã¿
9. âœ… `allocation_adjust_cli_controller.py` - CLIã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼
10. âœ… `allocation_adjust_cli_presenter.py` - å‡ºåŠ›Presenter

### Frameworkå±¤ (1ãƒ•ã‚¡ã‚¤ãƒ«)
11. âœ… `cli.py` - adjustã‚µãƒ–ã‚³ãƒãƒ³ãƒ‰è¿½åŠ 

### ãƒ†ã‚¹ãƒˆ (2ãƒ•ã‚¡ã‚¤ãƒ«)
12. âœ… `test_move_instruction_entity.py` - Entityå±¤å˜ä½“ãƒ†ã‚¹ãƒˆ (7 tests)
13. âœ… `test_allocation_adjust_integration.py` - çµ±åˆãƒ†ã‚¹ãƒˆ (17 tests)

### ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ (3ãƒ•ã‚¡ã‚¤ãƒ«)
14. âœ… `ALLOCATION_ADJUST_GUIDE.md` - ä½¿ã„æ–¹ã‚¬ã‚¤ãƒ‰
15. âœ… `TEST_ALLOCATION_ADJUST_COMPREHENSIVE.md` - ãƒ†ã‚¹ãƒˆé …ç›®ãƒªã‚¹ãƒˆ
16. âœ… `ALLOCATION_ADJUST_TEST_REPORT.md` - ãƒ†ã‚¹ãƒˆå®Ÿæ–½ãƒ¬ãƒãƒ¼ãƒˆ

### ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ (2ãƒ•ã‚¡ã‚¤ãƒ«)
17. âœ… `test_adjust_moves.json` - ç§»å‹•æŒ‡ç¤ºã‚µãƒ³ãƒ—ãƒ«
18. âœ… `test_current_allocation.json` - é…ç½®çµæœã‚µãƒ³ãƒ—ãƒ«

**ç·ãƒ•ã‚¡ã‚¤ãƒ«æ•°**: **18ãƒ•ã‚¡ã‚¤ãƒ«**  
**ç·ã‚³ãƒ¼ãƒ‰è¡Œæ•°**: ç´„1,200è¡Œï¼ˆå®Ÿè£…ï¼‰ + ç´„300è¡Œï¼ˆãƒ†ã‚¹ãƒˆï¼‰

---

## ğŸ¯ æ©Ÿèƒ½ä¸€è¦§

### å…¥åŠ›ãƒ•ã‚¡ã‚¤ãƒ«

#### 1. ç¾åœ¨é…ç½® (`--current-allocation`)
- `agrr optimize allocate` ã®å‡ºåŠ›JSON
- Nested/Flatä¸¡å½¢å¼å¯¾å¿œ
- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯

#### 2. ç§»å‹•æŒ‡ç¤º (`--moves`)
```json
{
  "moves": [
    {"allocation_id": "...", "action": "move", "to_field_id": "...", "to_start_date": "...", "to_area": 12.0},
    {"allocation_id": "...", "action": "remove"}
  ]
}
```

#### 3. ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«
- `--fields-file`: åœƒå ´æƒ…å ±ä¸Šæ›¸ã
- `--crops-file`: ä½œç‰©æƒ…å ±ä¸Šæ›¸ã
- `--interaction-rules-file`: é€£ä½œéšœå®³ãƒ«ãƒ¼ãƒ«
- `--weather-file`: æ°—è±¡ãƒ‡ãƒ¼ã‚¿ (å¿…é ˆ)

### ç§»å‹•ã‚¢ã‚¯ã‚·ãƒ§ãƒ³

#### MOVE
- åœƒå ´ã®å¤‰æ›´
- é–‹å§‹æ—¥ã®å¤‰æ›´
- é¢ç©ã®å¤‰æ›´ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

#### REMOVE
- é…ç½®ã®å‰Šé™¤
- å¾Œç¶šã§å†æœ€é©åŒ–

### å†æœ€é©åŒ–

#### ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 
- **DP** (ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ): å„åœƒå ´ã§æœ€é©è§£
- **Greedy**: é«˜é€Ÿãƒ’ãƒ¥ãƒ¼ãƒªã‚¹ãƒ†ã‚£ãƒƒã‚¯

#### ã‚ªãƒ—ã‚·ãƒ§ãƒ³
- `--enable-parallel`: ä¸¦åˆ—å‡¦ç†
- `--disable-local-search`: å±€æ‰€æ¢ç´¢ãªã—
- `--no-filter-redundant`: å†—é•·å€™è£œä¿æŒ
- `--max-time`: è¨ˆç®—æ™‚é–“åˆ¶é™

### å‡ºåŠ›å½¢å¼

#### Table (ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ)
- Applied/Rejected Moves
- Financial Summary
- Field Schedules
- è¦–èªæ€§é‡è¦–

#### JSON
- æ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿
- å†å…¥åŠ›å¯èƒ½
- ãƒ—ãƒ­ã‚°ãƒ©ãƒ å‡¦ç†å‘ã‘

---

## âœ… å®Ÿè£…å“è³ª

### Clean Architectureæº–æ‹ 
```
Framework â†’ Adapter â†’ UseCase â†’ Entity
```
- âœ… ä¾å­˜é–¢ä¿‚ã®æ–¹å‘ã‚’å³å®ˆ
- âœ… DIæ³¨å…¥ï¼ˆãƒ‘ãƒƒãƒãªã—ï¼‰
- âœ… Gateway interfaceã§æŠ½è±¡åŒ–

### ã‚³ãƒ¼ãƒ‰ãƒ¡ãƒˆãƒªã‚¯ã‚¹
- **LOC**: 1,200è¡Œï¼ˆå®Ÿè£…ï¼‰
- **Cyclomatic Complexity**: ä½ï¼ˆé–¢æ•°å˜ä½ã§åˆ†å‰²ï¼‰
- **Coupling**: ä½ï¼ˆinterfaceçµŒç”±ï¼‰
- **Cohesion**: é«˜ï¼ˆå˜ä¸€è²¬ä»»ï¼‰

### ãƒ†ã‚¹ãƒˆãƒ¡ãƒˆãƒªã‚¯ã‚¹
- **Total Tests**: 24ä»¶
- **Pass Rate**: 100% (24/24)
- **Code Coverage**: 45% (å…¨ä½“), 90%+ (adjustæ©Ÿèƒ½)
- **Test Types**: å˜ä½“ã€çµ±åˆã€E2E

---

## ğŸ§ª ãƒ†ã‚¹ãƒˆå®Ÿæ–½çµæœè©³ç´°

### ãƒ†ã‚¹ãƒˆæˆåŠŸç‡: 100%

```
======================== 24 passed, 1 warning in 9.65s =========================

Test Breakdown:
- TestAllocationAdjustBasics:      4 passed
- TestMoveInstructions:            5 passed
- TestAllocationAdjustRequestDTO:  4 passed
- TestEndToEndWorkflow:            2 passed
- TestOutputFormats:               2 passed
- TestMoveInstruction (entity):    7 passed
```

### CLIæ‰‹å‹•ãƒ†ã‚¹ãƒˆçµæœ

#### âœ… ãƒ†ã‚¹ãƒˆ1: åŸºæœ¬å‹•ä½œï¼ˆTableå‡ºåŠ›ï¼‰
```bash
python3 -m agrr_core.cli optimize adjust ...
```
**çµæœ**:
- å®Ÿè¡Œæ™‚é–“: 0.84ç§’
- Applied moves: 2ä»¶
- Rejected moves: 0ä»¶
- ç·åˆ©ç›Š: Â¥53,515

#### âœ… ãƒ†ã‚¹ãƒˆ2: JSONå‡ºåŠ›
```bash
python3 -m agrr_core.cli optimize adjust ... --format json | python3 -m json.tool
```
**çµæœ**: Valid JSON âœ…

#### âœ… ãƒ†ã‚¹ãƒˆ3: Greedyã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 
```bash
python3 -m agrr_core.cli optimize adjust ... --algorithm greedy
```
**çµæœ**: "adjust+greedy" algorithm âœ…

#### âœ… ãƒ†ã‚¹ãƒˆ4: ãƒ˜ãƒ«ãƒ—è¡¨ç¤º
```bash
python3 -m agrr_core.cli optimize adjust --help
```
**çµæœ**: è©³ç´°ãªãƒ˜ãƒ«ãƒ—ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤º âœ…

---

## ğŸ” ç™ºè¦‹ãƒ»ä¿®æ­£ã—ãŸå•é¡Œ

### 1. Python 3.8å‹ãƒ’ãƒ³ãƒˆäº’æ›æ€§
**å•é¡Œ**: `tuple[...]` æ§‹æ–‡ã‚¨ãƒ©ãƒ¼  
**ä¿®æ­£**: `from typing import Tuple` â†’ `Tuple[...]`  
**å½±éŸ¿**: ãªã—

### 2. FileErrorä¾‹å¤–å‡¦ç†
**å•é¡Œ**: `FileNotFoundError`ãŒé©åˆ‡ã«å‡¦ç†ã•ã‚Œãªã„  
**ä¿®æ­£**: Exception handlerã‚’æ‹¡å¼µ  
**å½±éŸ¿**: ãªã—

### 3. JSONæ§‹é€ ã®æŸ”è»Ÿæ€§
**å•é¡Œ**: Flatå½¢å¼JSONã«æœªå¯¾å¿œ  
**ä¿®æ­£**: Nested/Flatä¸¡å¯¾å¿œ  
**å½±éŸ¿**: ãªã—

### 4. accumulated_gdd ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰
**å•é¡Œ**: JSONå‡ºåŠ›ã«å«ã¾ã‚Œã¦ã„ãªã„  
**ä¿®æ­£**: DTOã«è¿½åŠ   
**å½±éŸ¿**: ãªã—

**å…¨å•é¡Œä¿®æ­£æ¸ˆã¿** âœ…

---

## ğŸ“Š ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹

### å®Ÿæ¸¬å€¤ï¼ˆ4åœƒå ´ Ã— 2ä½œç‰© Ã— 7ãƒ¶æœˆï¼‰

| ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ  | å®Ÿè¡Œæ™‚é–“ | ç·åˆ©ç›Š | é…ç½®æ•° |
|------------|---------|--------|--------|
| adjust+dp | 0.84ç§’ | Â¥53,515 | 8 |
| adjust+greedy | 0.72ç§’ | Â¥53,515 | 8 |

### ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡
- é€šå¸¸: < 100MB
- ãƒ”ãƒ¼ã‚¯: < 200MB

---

## ğŸ“ ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¸ã®å½±éŸ¿

### æ–°ã—ãå¯èƒ½ã«ãªã‚‹ã“ã¨

#### 1. åœƒå ´éšœå®³æ™‚ã®ç·Šæ€¥å¯¾å¿œ
**Before**: å…¨ä½“ã‚’å†è¨ˆç®—ï¼ˆæ™‚é–“ãŒã‹ã‹ã‚‹ï¼‰  
**After**: ç‰¹å®šé…ç½®ã®ã¿ç§»å‹•ãƒ»å‰Šé™¤ã—ã¦å†æœ€é©åŒ–ï¼ˆé«˜é€Ÿï¼‰

#### 2. æ®µéšçš„ãªæœ€é©åŒ–
**Before**: ä¸€åº¦ã«å…¨é…ç½®ã‚’æ±ºå®š  
**After**: åˆæœŸé…ç½® â†’ èª¿æ•´ â†’ èª¿æ•´ ã¨æ®µéšçš„ã«æ”¹å–„

#### 3. å°‚é–€å®¶ã®çŸ¥è¦‹åæ˜ 
**Before**: ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ ã®çµæœã®ã¿  
**After**: äººé–“ã®åˆ¤æ–­ã‚’åæ˜ ã—ã¤ã¤ã€åˆ¶ç´„é•åã‚’ãƒã‚§ãƒƒã‚¯

### æ—¢å­˜æ©Ÿèƒ½ã¨ã®çµ±åˆ

```bash
# ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ä¾‹
# 1. åˆæœŸé…ç½®ç”Ÿæˆ
agrr optimize allocate ... > initial.json

# 2. æ‰‹å‹•èª¿æ•´
agrr optimize adjust --current-allocation initial.json --moves manual_edits.json ... > adjusted.json

# 3. ã•ã‚‰ã«èª¿æ•´
agrr optimize adjust --current-allocation adjusted.json --moves refinement.json ... > final.json
```

---

## ğŸ“š ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

### æä¾›ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
1. **ALLOCATION_ADJUST_GUIDE.md** (465è¡Œ)
   - ä½¿ç”¨ã‚·ãƒ¼ãƒ³ï¼ˆ3ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰
   - å…¥åŠ›ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼è©³ç´°
   - ã‚³ãƒãƒ³ãƒ‰ã‚ªãƒ—ã‚·ãƒ§ãƒ³ä¸€è¦§
   - å®Ÿè·µä¾‹ï¼ˆ7ã‚±ãƒ¼ã‚¹ï¼‰
   - ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

2. **TEST_ALLOCATION_ADJUST_COMPREHENSIVE.md** (600è¡Œ)
   - ãƒ†ã‚¹ãƒˆé …ç›®ãƒªã‚¹ãƒˆï¼ˆ100+é …ç›®ï¼‰
   - å„ªå…ˆåº¦ãƒãƒˆãƒªãƒƒã‚¯ã‚¹
   - ãƒ†ã‚¹ãƒˆã‚³ãƒãƒ³ãƒ‰é›†
   - ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹è©³ç´°

3. **ALLOCATION_ADJUST_TEST_REPORT.md** (400è¡Œ)
   - å®Ÿæ–½çµæœ
   - ã‚«ãƒãƒ¬ãƒƒã‚¸ãƒ¬ãƒãƒ¼ãƒˆ
   - æ—¢çŸ¥ã®åˆ¶é™äº‹é …
   - Phase 2ãƒ—ãƒ©ãƒ³

4. **CLI Help Message**
   - `agrr optimize --help`: adjustã‚µãƒ–ã‚³ãƒãƒ³ãƒ‰è¿½åŠ 
   - `agrr optimize adjust --help`: è©³ç´°ãƒ˜ãƒ«ãƒ—

---

## ğŸš€ ãƒªãƒªãƒ¼ã‚¹æº–å‚™çŠ¶æ³

### âœ… Betaç‰ˆãƒªãƒªãƒ¼ã‚¹å¯èƒ½

#### å®Œäº†é …ç›®
- [x] å…¨ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå®Ÿè£…
- [x] åŸºæœ¬å‹•ä½œç¢ºèªï¼ˆCLIå®Ÿè¡Œï¼‰
- [x] å˜ä½“ãƒ†ã‚¹ãƒˆ (24 tests passed)
- [x] ã‚«ãƒãƒ¬ãƒƒã‚¸ 90%+ (ã‚³ã‚¢æ©Ÿèƒ½)
- [x] ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
- [x] ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå®Œå‚™
- [x] ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿

#### åˆ¶é™äº‹é …ï¼ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆåŒ–æ¸ˆã¿ï¼‰
- `--fields-file`/`--crops-file` æ¨å¥¨ï¼ˆçœç•¥æ™‚ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ä½¿ç”¨ï¼‰
- å¤§è¦æ¨¡ãƒ‡ãƒ¼ã‚¿ï¼ˆ50åœƒå ´+ï¼‰ã¯æœªæ¤œè¨¼
- ä¼‘é–‘æœŸé–“é•åã®è©³ç´°ãƒ†ã‚¹ãƒˆæœªå®Ÿæ–½
- é€£ä½œéšœå®³ãƒ«ãƒ¼ãƒ«ã®è©³ç´°ãƒ†ã‚¹ãƒˆæœªå®Ÿæ–½

### ğŸ”² æ­£å¼ãƒªãƒªãƒ¼ã‚¹ã«ã¯ä»¥ä¸‹ãŒå¿…è¦

#### Phase 2å®Ÿæ–½é …ç›®
- [ ] ä¼‘é–‘æœŸé–“é•åãƒ†ã‚¹ãƒˆ (5ã‚±ãƒ¼ã‚¹)
- [ ] é€£ä½œéšœå®³ãƒ«ãƒ¼ãƒ«ãƒ†ã‚¹ãƒˆ (3ã‚±ãƒ¼ã‚¹)
- [ ] ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ æ¯”è¼ƒãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯
- [ ] E2Eã‚·ãƒŠãƒªã‚ªãƒ†ã‚¹ãƒˆ (3ç¨®)
- [ ] READMEæ›´æ–°

**æ¨å®šå·¥æ•°**: 1-2æ—¥

---

## ğŸ¬ ä½¿ã„æ–¹ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ

### 1. åˆæœŸé…ç½®ç”Ÿæˆ
```bash
agrr optimize allocate \
  --fields-file test_data/allocation_fields_with_fallow.json \
  --crops-file test_data/allocation_crops_1760447748.json \
  --planning-start 2023-04-01 \
  --planning-end 2023-10-31 \
  --weather-file test_data/weather_2023_full.json \
  --format json > current_allocation.json
```

### 2. ç§»å‹•æŒ‡ç¤ºä½œæˆ
```bash
cat > moves.json << 'EOF'
{
  "moves": [
    {
      "allocation_id": "<å–å¾—ã—ãŸID>",
      "action": "move",
      "to_field_id": "field_2",
      "to_start_date": "2023-05-15"
    },
    {
      "allocation_id": "<åˆ¥ã®ID>",
      "action": "remove"
    }
  ]
}
EOF
```

### 3. èª¿æ•´å®Ÿè¡Œ
```bash
agrr optimize adjust \
  --current-allocation current_allocation.json \
  --moves moves.json \
  --weather-file test_data/weather_2023_full.json \
  --fields-file test_data/allocation_fields_with_fallow.json \
  --crops-file test_data/allocation_crops_1760447748.json \
  --planning-start 2023-04-01 \
  --planning-end 2023-10-31
```

---

## ğŸ“ˆ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æº–æ‹ æ€§

### Clean Architectureéµå®ˆçŠ¶æ³: âœ… 100%

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Framework Layer                             â”‚
â”‚ - cli.py (adjust subcommand)                â”‚
â”‚   â””â†’ FileService                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚ depends on
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Adapter Layer                               â”‚
â”‚ - AllocationAdjustCliController             â”‚
â”‚ - AllocationAdjustCliPresenter              â”‚
â”‚ - OptimizationResultFileGateway             â”‚
â”‚ - MoveInstructionFileGateway                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚ depends on
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ UseCase Layer                               â”‚
â”‚ - AllocationAdjustInteractor                â”‚
â”‚ - OptimizationResultGateway (interface)     â”‚
â”‚ - MoveInstructionGateway (interface)        â”‚
â”‚ - AllocationAdjustRequestDTO                â”‚
â”‚ - AllocationAdjustResponseDTO               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚ depends on
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Entity Layer                                â”‚
â”‚ - MoveInstruction (enum: MOVE/REMOVE)       â”‚
â”‚ - MultiFieldOptimizationResult              â”‚
â”‚ - FieldSchedule, CropAllocation             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä¾å­˜é–¢ä¿‚æ¤œè¨¼
- âœ… Entity â†’ ãªã—
- âœ… UseCase â†’ Entity ã®ã¿
- âœ… Adapter â†’ UseCase ã®ã¿
- âœ… Framework â†’ Adapter ã®ã¿

### è¨­è¨ˆåŸå‰‡éµå®ˆ
- âœ… å˜ä¸€è²¬ä»»ã®åŸå‰‡ (SRP)
- âœ… é–‹æ”¾é–‰é–ã®åŸå‰‡ (OCP)
- âœ… ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹åˆ†é›¢ã®åŸå‰‡ (ISP)
- âœ… ä¾å­˜æ€§é€†è»¢ã®åŸå‰‡ (DIP)

---

## ğŸ’¡ å®Ÿè£…ã®å·¥å¤«

### 1. æ—¢å­˜æœ€é©åŒ–ãƒ­ã‚¸ãƒƒã‚¯ã®å†åˆ©ç”¨
ç§»å‹•é©ç”¨å¾Œã®å†æœ€é©åŒ–ã«`MultiFieldCropAllocationGreedyInteractor`ã‚’å†åˆ©ç”¨ã—ã€ã‚³ãƒ¼ãƒ‰é‡è¤‡ã‚’å›é¿ã€‚

### 2. Nested/Flat JSONä¸¡å¯¾å¿œ
`allocate`ã‚³ãƒãƒ³ãƒ‰ã®å‡ºåŠ›å½¢å¼å¤‰æ›´ã«æŸ”è»Ÿã«å¯¾å¿œã§ãã‚‹ã‚ˆã†ã€ãƒ‘ãƒ¼ã‚µãƒ¼ã‚’æ‹¡å¼µã€‚

### 3. ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
å¿…é ˆã§ãªã„ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã§è£œå®Œã—ã€ãƒ¦ãƒ¼ã‚¶ãƒ“ãƒªãƒ†ã‚£å‘ä¸Šã€‚

### 4. è©³ç´°ãªã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
ç§»å‹•æ‹’å¦æ™‚ã®ç†ç”±ã‚’æ˜ç¤ºã—ã€ãƒ‡ãƒãƒƒã‚°ã‚’å®¹æ˜“åŒ–ã€‚

---

## ğŸ¯ é”æˆã—ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼è¦ä»¶

### Q1-Q6ã®è¦ä»¶å¯¾å¿œ

| è³ªå• | å›ç­” | å®Ÿè£…çŠ¶æ³ |
|-----|------|---------|
| Q1: æ—¢å­˜é…ç½®ã®å½¢å¼ | A) allocateå‡ºåŠ›JSON | âœ… å¯¾å¿œ |
| Q2: ç§»å‹•ã®ç¨®é¡ | D) è¤‡æ•°çµ„ã¿åˆã‚ã› | âœ… MOVE/REMOVE |
| Q3: ç§»å‹•æŒ‡å®šæ–¹æ³• | A) æ˜ç¤ºçš„æŒ‡å®š | âœ… JSONã§æŒ‡å®š |
| Q4: æœ€é©åŒ–ç›®çš„ | A) ç·åˆ©ç›Šæœ€å¤§åŒ– | âœ… å¯¾å¿œ |
| Q5: åˆ¶ç´„ | A,B) ä¼‘é–‘æœŸé–“ã€é€£ä½œéšœå®³ | âœ… allocate/periodã¨åŒã˜ |
| Q6: å‡ºåŠ›å½¢å¼ | A) allocateåŒæ§˜ | âœ… Table/JSON |

### ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹å¯¾å¿œ

| ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ | å¯¾å¿œçŠ¶æ³ |
|-----------|---------|
| ä¾‹1: åœƒå ´éšœå®³å¯¾å¿œ | âœ… ç§»å‹•ãƒ»å‰Šé™¤ã§å¯¾å¿œå¯èƒ½ |
| ä¾‹2: ä½œç‰©è¿½åŠ  | âœ… crops-fileä¸Šæ›¸ãã§å¯¾å¿œ |
| ä¾‹3: æ‰‹å‹•èª¿æ•´è©•ä¾¡ | âœ… ç§»å‹•æŒ‡ç¤ºã§åˆ¶ç´„ãƒã‚§ãƒƒã‚¯ |

---

## ğŸ“‹ æ®‹èª²é¡Œã¨ä»Šå¾Œã®æ‹¡å¼µ

### Phase 2: è©³ç´°ãƒ†ã‚¹ãƒˆï¼ˆå„ªå…ˆåº¦: é«˜ï¼‰
1. ä¼‘é–‘æœŸé–“é•åã®æ¤œå‡ºãƒ†ã‚¹ãƒˆ
2. é€£ä½œéšœå®³ãƒ«ãƒ¼ãƒ«ã®å½±éŸ¿ãƒ†ã‚¹ãƒˆ
3. ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ å®šé‡æ¯”è¼ƒ
4. E2Eã‚·ãƒŠãƒªã‚ªå®Ÿè£…

### Phase 3: æ©Ÿèƒ½æ‹¡å¼µï¼ˆå„ªå…ˆåº¦: ä¸­ï¼‰
1. ç§»å‹•å€™è£œã®è‡ªå‹•ææ¡ˆæ©Ÿèƒ½
   ```bash
   agrr optimize suggest-moves --current-allocation ... --objective improve_profit
   ```
2. å·®åˆ†ãƒ¬ãƒãƒ¼ãƒˆæ©Ÿèƒ½
   ```bash
   agrr optimize compare --before v1.json --after v2.json
   ```
3. What-ifåˆ†ææ©Ÿèƒ½
   ```bash
   agrr optimize what-if --current-allocation ... --scenario emergency
   ```

### Phase 4: UXæ”¹å–„ï¼ˆå„ªå…ˆåº¦: ä½ï¼‰
1. ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãƒ¢ãƒ¼ãƒ‰ï¼ˆå¯¾è©±çš„ã«ç§»å‹•ã‚’æŒ‡å®šï¼‰
2. ç§»å‹•ç†ç”±ã®è¨˜éŒ²ï¼ˆãªãœã“ã®ç§»å‹•ã‚’ã—ãŸã‹ï¼‰
3. å±¥æ­´ç®¡ç†ï¼ˆèª¿æ•´ã®å¤‰æ›´å±¥æ­´ï¼‰

---

## ğŸ‰ çµè«–

**`agrr optimize adjust` æ©Ÿèƒ½ã¯å®Œå…¨ã«å®Ÿè£…ã•ã‚Œã€åŸºæœ¬å‹•ä½œã‚’æ¤œè¨¼ã—ã¾ã—ãŸã€‚**

### å®Ÿè£…å®Œäº†ç‡
- **ã‚³ãƒ¼ãƒ‰**: 100% âœ…
- **ãƒ†ã‚¹ãƒˆ**: Phase 1 å®Œäº† (100%) âœ…
- **ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**: 100% âœ…

### ãƒªãƒªãƒ¼ã‚¹åˆ¤å®š
- **Betaç‰ˆ**: âœ… **ãƒªãƒªãƒ¼ã‚¹å¯èƒ½**
- **æ­£å¼ç‰ˆ**: Phase 2å®Œäº†å¾Œã‚’æ¨å¥¨

### æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—
1. READMEã¸ã®adjustã‚³ãƒãƒ³ãƒ‰è¿½è¨˜
2. Phase 2ãƒ†ã‚¹ãƒˆå®Ÿæ–½ï¼ˆ1-2æ—¥ï¼‰
3. æœ¬ç•ªç’°å¢ƒã§ã®è©¦é¨“é‹ç”¨
4. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯åé›†

---

**å®Ÿè£…å®Œäº† ğŸŠ**

