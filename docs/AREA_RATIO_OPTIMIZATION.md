# åœƒå ´ã”ã¨ã®ä½œä»˜é¢ç©æ¯”ç‡ã®æœ€é©åŒ–

## è³ªå•

**å„åœƒå ´ã§ã€ä½œç‰©ã®ä½œä»˜é¢ç©ã®æ¯”ç‡ã‚’å€‹åˆ¥ã«æœ€é©åŒ–ã§ãã‚‹ã‹ï¼Ÿ**

---

## ç¾åœ¨ã®è¨­è¨ˆã®ç¢ºèª

### ç¾çŠ¶ã®å‰æ

```python
# ç¾åœ¨ã®å€™è£œç”Ÿæˆ
for field in fields:
    for crop in crops:
        # åœƒå ´å…¨ä½“ã‚’1ã¤ã®ä½œç‰©ã§ä½¿ã†ã“ã¨ã‚’å‰æ
        max_quantity = field.area / crop.area_per_unit
        
        candidate = AllocationCandidate(
            field=field,
            crop=crop,
            quantity=max_quantity,  # åœƒå ´å…¨ä½“ã‚’ä½¿ç”¨
            area_used=field.area,   # åœƒå ´å…¨ä½“
        )
```

**å•é¡Œ**: åœƒå ´ã‚’è¤‡æ•°ä½œç‰©ã§åˆ†å‰²åˆ©ç”¨ã™ã‚‹ã“ã¨ã‚’è€ƒæ…®ã—ã¦ã„ãªã„

---

## æ±‚ã‚ã‚‰ã‚Œã‚‹æœ€é©åŒ–

### ä¾‹ï¼šåœƒå ´ã®åˆ†å‰²åˆ©ç”¨

```
Field A (1000mÂ²) ã§ã®ä½œä»˜æ¯”ç‡ã®æœ€é©åŒ–:

Option 1: Rice 100%
  Rice 4000æ ª (1000mÂ²)
  åˆ©ç›Š: 1,500,000å††

Option 2: Rice 50% + Tomato 50%
  Rice 2000æ ª (500mÂ²)
  Tomato 1666æ ª (500mÂ²)
  åˆ©ç›Š: 1,800,000å†† â† ã‚ˆã‚Šé«˜ã„ï¼

Option 3: Rice 30% + Tomato 50% + Wheat 20%
  Rice 1200æ ª (300mÂ²)
  Tomato 1666æ ª (500mÂ²)
  Wheat 1000æ ª (200mÂ²)
  åˆ©ç›Š: 1,900,000å†† â† ã•ã‚‰ã«é«˜ã„ï¼
  
â†’ æœ€é©ãªé¢ç©æ¯”ç‡ã¯ï¼Ÿ
```

---

## 2ã¤ã®ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ

### Approach A: é›¢æ•£çš„ãªçµ„ã¿åˆã‚ã›æœ€é©åŒ–ï¼ˆç¾åœ¨ã®å®Ÿè£…ï¼‰

**æ–¹é‡**: 
- å„å‰²ã‚Šå½“ã¦ã¯ç‹¬ç«‹
- æ™‚é–“çš„ã«åˆ†é›¢ï¼ˆNon-overlappingï¼‰
- åŒã˜åœƒå ´ãƒ»åŒã˜æ™‚æœŸã«1ã¤ã®ä½œç‰©ã®ã¿

```
Field A (1000mÂ²):
  æœŸé–“1 (4/1-8/31): Rice 4000æ ª (1000mÂ²å…¨ä½“)
  æœŸé–“2 (9/1-12/31): Tomato 3333æ ª (1000mÂ²å…¨ä½“)
  
ç‰¹å¾´:
  âœ“ æ™‚é–“è»¸ã§åˆ†é›¢
  âœ“ å®Ÿè£…ãŒã‚·ãƒ³ãƒ—ãƒ«
  âœ— åŒæ™‚æœŸã®æ··æ¤ã¯ã§ããªã„
```

---

### Approach B: é€£ç¶šçš„ãªé¢ç©æ¯”ç‡æœ€é©åŒ–ï¼ˆæ–°è¦æ¤œè¨ï¼‰

**æ–¹é‡**:
- å„åœƒå ´ã§ä½œç‰©ã®é¢ç©æ¯”ç‡ã‚’æ±ºå®š
- åŒã˜æ™‚æœŸã«è¤‡æ•°ä½œç‰©ã‚’ä¸¦è¡Œæ ½åŸ¹
- é€£ç¶šå¤‰æ•°ã®æœ€é©åŒ–

```
Field A (1000mÂ²):
  æœŸé–“ (4/1-8/31):
    - Rice: 300mÂ² (30%)
    - Tomato: 500mÂ² (50%)
    - Wheat: 200mÂ² (20%)
  åˆè¨ˆ: 1000mÂ² (100%)
  
ç‰¹å¾´:
  âœ“ åŒæ™‚æœŸã®æ··æ¤ãŒå¯èƒ½
  âœ“ ãƒªã‚¹ã‚¯åˆ†æ•£
  âœ— å®Ÿè£…ãŒè¤‡é›‘
```

---

## é¢ç©æ¯”ç‡æœ€é©åŒ–ã®æ•°å­¦çš„å®šå¼åŒ–

### æ±ºå®šå¤‰æ•°

```python
# åœƒå ´ fã€æ™‚æœŸ t ã§ã®ä½œç‰© c ã®é¢ç©æ¯”ç‡
ratio[f][t][c] âˆˆ [0, 1]

åˆ¶ç´„:
  Î£(c) ratio[f][t][c] = 1  # å„åœƒå ´ãƒ»å„æ™‚æœŸã§åˆè¨ˆ100%
  
æ•°é‡:
  quantity[f][t][c] = (field[f].area Ã— ratio[f][t][c]) / crop[c].area_per_unit
```

### ç›®çš„é–¢æ•°

```python
Maximize: Î£(f, t, c) [
  quantity[f][t][c] Ã— (
    revenue_per_unit[c] - 
    cost_per_day[f] Ã— growth_days[t][c] / quantity[f][t][c]
  )
]
```

---

## å®Ÿè£…æ–¹æ³•

### Method 1: é›¢æ•£çš„ãªæ¯”ç‡ï¼ˆå®Ÿè£…ã—ã‚„ã™ã„ï¼‰

**æ–¹é‡**: äºˆã‚å®šç¾©ã•ã‚ŒãŸæ¯”ç‡ãƒ‘ã‚¿ãƒ¼ãƒ³ã‹ã‚‰é¸æŠ

```python
# äº‹å‰å®šç¾©ã•ã‚ŒãŸæ¯”ç‡ãƒ‘ã‚¿ãƒ¼ãƒ³
RATIO_PATTERNS = [
    {"rice": 1.0},                              # 100% Rice
    {"rice": 0.5, "tomato": 0.5},              # 50%-50%
    {"rice": 0.3, "tomato": 0.5, "wheat": 0.2}, # 30%-50%-20%
    {"rice": 0.7, "tomato": 0.3},              # 70%-30%
    # ... more patterns
]

# å„åœƒå ´ã§å„ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’è©•ä¾¡
for field in fields:
    for pattern in RATIO_PATTERNS:
        profit = calculate_profit(field, pattern)
        candidates.append((field, pattern, profit))
```

**ãƒ¡ãƒªãƒƒãƒˆ**:
- âœ“ å®Ÿè£…ãŒç°¡å˜
- âœ“ è¨ˆç®—é‡ãŒå°‘ãªã„
- âœ“ æ—¢å­˜ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã«çµ±åˆã—ã‚„ã™ã„

**ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ**:
- âœ— æœ€é©æ¯”ç‡ã‚’è¦‹é€ƒã™å¯èƒ½æ€§
- âœ— ãƒ‘ã‚¿ãƒ¼ãƒ³æ•°ãŒé™å®šçš„

---

### Method 2: é€£ç¶šæœ€é©åŒ–ï¼ˆç·šå½¢è¨ˆç”»æ³•ï¼‰

**æ–¹é‡**: é€£ç¶šå¤‰æ•°ã¨ã—ã¦æ¯”ç‡ã‚’æœ€é©åŒ–

```python
from pulp import *

def optimize_area_ratios(field, crops, period):
    """ç·šå½¢è¨ˆç”»æ³•ã§é¢ç©æ¯”ç‡ã‚’æœ€é©åŒ–"""
    prob = LpProblem(f"AreaRatio_{field.field_id}", LpMaximize)
    
    # æ±ºå®šå¤‰æ•°: ratio[crop] âˆˆ [0, 1]
    ratios = {
        crop.crop_id: LpVariable(f"ratio_{crop.crop_id}", 0, 1, LpContinuous)
        for crop in crops
    }
    
    # åˆ¶ç´„: æ¯”ç‡ã®åˆè¨ˆ = 1
    prob += lpSum(ratios.values()) == 1
    
    # ç›®çš„é–¢æ•°: ç·åˆ©ç›Šã®æœ€å¤§åŒ–
    profits = {}
    for crop in crops:
        quantity = (field.area * ratios[crop.crop_id]) / crop.area_per_unit
        revenue = quantity * crop.revenue_per_area * crop.area_per_unit
        cost = period.growth_days * field.daily_fixed_cost * ratios[crop.crop_id]
        profits[crop.crop_id] = revenue - cost
    
    prob += lpSum(profits.values())
    
    # è§£ã
    prob.solve()
    
    # çµæœã‚’å–å¾—
    optimal_ratios = {
        crop_id: var.varValue 
        for crop_id, var in ratios.items()
    }
    
    return optimal_ratios
```

**ãƒ¡ãƒªãƒƒãƒˆ**:
- âœ“ å³å¯†ãªæœ€é©æ¯”ç‡
- âœ“ æŸ”è»Ÿæ€§ãŒé«˜ã„

**ãƒ‡ãƒ¡ãƒªãƒƒãƒˆ**:
- âœ— å®Ÿè£…ãŒè¤‡é›‘
- âœ— å¤–éƒ¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒªå¿…è¦ï¼ˆPuLPç­‰ï¼‰
- âœ— è¨ˆç®—æ™‚é–“å¢—åŠ 

---

### Method 3: è²ªæ¬²æ³• + å¾®èª¿æ•´ï¼ˆæ¨å¥¨ï¼‰

**æ–¹é‡**: è²ªæ¬²æ³•ã§åˆæœŸé…åˆ†â†’æ•°å€¤æœ€é©åŒ–ã§å¾®èª¿æ•´

```python
def optimize_area_ratios_greedy(field, crops, period):
    """è²ªæ¬²æ³• + å¾®èª¿æ•´ã§é¢ç©æ¯”ç‡ã‚’æœ€é©åŒ–"""
    
    # Phase 1: è²ªæ¬²æ³•ã§åˆæœŸé…åˆ†
    allocations = []
    remaining_area = field.area
    
    # åˆ©ç›Šç‡ã§ã‚½ãƒ¼ãƒˆ
    sorted_crops = sorted(crops, key=lambda c: calculate_profit_rate(c), reverse=True)
    
    for crop in sorted_crops:
        if remaining_area <= 0:
            break
        
        # è²ªæ¬²ã«å‰²ã‚Šå½“ã¦
        area_to_allocate = min(remaining_area, field.area * 0.5)  # æœ€å¤§50%
        quantity = area_to_allocate / crop.area_per_unit
        
        allocations.append({
            'crop': crop,
            'area': area_to_allocate,
            'quantity': quantity
        })
        
        remaining_area -= area_to_allocate
    
    # Phase 2: å¾®èª¿æ•´ï¼ˆå‹¾é…æ³•ï¼‰
    # å„ä½œç‰©ã®é¢ç©ã‚’Â±10%èª¿æ•´ã—ã¦åˆ©ç›Šã‚’æœ€å¤§åŒ–
    for iteration in range(10):
        improved = False
        
        for i in range(len(allocations)):
            for delta in [-0.1, -0.05, 0.05, 0.1]:  # Â±10%, Â±5%
                # é¢ç©ã‚’èª¿æ•´
                new_area = allocations[i]['area'] * (1 + delta)
                
                # ä»–ã®ä½œç‰©ã‹ã‚‰é¢ç©ã‚’å–ã‚‹/æ¸¡ã™
                if delta > 0:
                    # ä»–ã‹ã‚‰å–ã‚‹
                    # ...
                
                new_profit = calculate_profit(new_allocations)
                if new_profit > current_profit:
                    allocations = new_allocations
                    improved = True
                    break
        
        if not improved:
            break
    
    return allocations
```

**ãƒ¡ãƒªãƒƒãƒˆ**:
- âœ“ ãƒãƒ©ãƒ³ã‚¹ãŒè‰¯ã„
- âœ“ å®Ÿè£…ãŒæ¯”è¼ƒçš„ç°¡å˜
- âœ“ å®Ÿç”¨çš„ãªå“è³ª

---

## å®Ÿè£…ã®é›£æ˜“åº¦ã¨åŠ¹æœ

| Method | å®Ÿè£…é›£æ˜“åº¦ | è¨ˆç®—æ™‚é–“ | è§£ã®å“è³ª | æ¨å¥¨åº¦ |
|--------|-----------|---------|---------|--------|
| **é›¢æ•£ãƒ‘ã‚¿ãƒ¼ãƒ³** | â˜…â˜†â˜†â˜†â˜† | ä½ | 80-90% | â­â­â­â­â˜† |
| **é€£ç¶šæœ€é©åŒ–(LP)** | â˜…â˜…â˜…â˜…â˜† | ä¸­ | 100% | â­â­â­â˜†â˜† |
| **è²ªæ¬²+å¾®èª¿æ•´** | â˜…â˜…â˜…â˜†â˜† | ä¸­ | 90-95% | â­â­â­â­â­ |

---

## å®Ÿè£…ã®çµ±åˆ

### ç¾åœ¨ã®å€™è£œç”Ÿæˆã¸ã®çµ±åˆ

```python
async def _generate_candidates(fields, crops, request):
    candidates = []
    
    for field in fields:
        # â˜… å„åœƒå ´ã§é¢ç©æ¯”ç‡ã‚’æœ€é©åŒ–
        optimal_ratios = optimize_area_ratios(field, crops, request)
        
        # æœ€é©åŒ–ã•ã‚ŒãŸæ¯”ç‡ã«åŸºã¥ã„ã¦å€™è£œã‚’ç”Ÿæˆ
        for crop_id, ratio in optimal_ratios.items():
            if ratio > 0.05:  # 5%ä»¥ä¸Šãªã‚‰å€™è£œã¨ã—ã¦è¿½åŠ 
                crop = find_crop(crops, crop_id)
                area = field.area * ratio
                quantity = area / crop.area_per_unit
                
                # Period ã¯DPã§æœ€é©åŒ–
                period_result = await optimize_period_dp(field, crop)
                
                candidates.append(AllocationCandidate(
                    field=field,
                    crop=crop,
                    quantity=quantity,  # æœ€é©æ¯”ç‡ã‹ã‚‰è¨ˆç®—
                    area_used=area,
                    # ...
                ))
    
    return candidates
```

---

## å…·ä½“ä¾‹

### Example 1: å˜ä¸€ä½œç‰© vs æ··æ¤

```
Field A (1000mÂ², 5000å††/æ—¥)

Option 1: Rice 100%
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Rice 4000æ ª (1000mÂ²)       â”‚
â”‚                                 â”‚
â”‚ Cost: 765,000å††                 â”‚
â”‚ Revenue: 2,500,000å††            â”‚
â”‚ Profit: 1,735,000å††             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Option 2: Rice 50% + Tomato 50%
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Rice 2000æ ª â”‚ Tomato 1666æ ª     â”‚
â”‚   (500mÂ²)   â”‚    (500mÂ²)        â”‚
â”‚             â”‚                   â”‚
â”‚ Cost: 382,500å†† + 382,500å††     â”‚
â”‚ Revenue: 1,250,000 + 1,500,000  â”‚
â”‚ Profit: 1,985,000å†† âœ“ +250,000 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â†’ æ··æ¤ã®æ–¹ãŒåˆ©ç›ŠãŒé«˜ã„ï¼
```

---

### Example 2: 3ä½œç‰©ã®æœ€é©æ¯”ç‡

```
Field A (1000mÂ²)
Crops: Rice, Tomato, Wheat

é›¢æ•£ãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã®æ¢ç´¢:

Pattern 1: 100%-0%-0%
  Profit: 1,735,000å††

Pattern 2: 50%-50%-0%
  Profit: 1,985,000å††

Pattern 3: 30%-50%-20%
  Rice 1200æ ª (300mÂ²)
  Tomato 1666æ ª (500mÂ²)
  Wheat 1000æ ª (200mÂ²)
  Profit: 2,100,000å†† âœ“ æœ€è‰¯

Pattern 4: 33%-33%-33%
  Profit: 1,950,000å††

â†’ æœ€é©æ¯”ç‡: 30%-50%-20%
```

---

## æ™‚é–“è»¸ã¨ã®é–¢ä¿‚

### ã‚±ãƒ¼ã‚¹A: æ™‚é–“åˆ†é›¢ï¼ˆç¾åœ¨ã®å®Ÿè£…ï¼‰

```
Field A (1000mÂ²):
  4/1-8/31:  Rice 4000æ ª (1000mÂ²å…¨ä½“)
  9/1-12/31: Tomato 3333æ ª (1000mÂ²å…¨ä½“)
  
ç‰¹å¾´:
  - æ™‚æœŸã”ã¨ã«100%ä½¿ç”¨
  - æ··æ¤ãªã—
  - Periodæœ€é©åŒ–ã§è§£æ±ºæ¸ˆã¿
```

---

### ã‚±ãƒ¼ã‚¹B: ç©ºé–“åˆ†å‰²ï¼ˆæ–°è¦æ¤œè¨ï¼‰

```
Field A (1000mÂ²):
  4/1-8/31ã®é–“ã€åŒæ™‚ã«:
    - Rice: 300mÂ² (30%)
    - Tomato: 500mÂ² (50%)
    - Wheat: 200mÂ² (20%)
  
ç‰¹å¾´:
  - åŒã˜æ™‚æœŸã«è¤‡æ•°ä½œç‰©
  - é¢ç©æ¯”ç‡ã®æœ€é©åŒ–ãŒå¿…è¦
  - ã‚ˆã‚Šè¤‡é›‘
```

---

### ã‚±ãƒ¼ã‚¹C: æ™‚é–“Ã—ç©ºé–“ã®ãƒãƒˆãƒªã‚¯ã‚¹ï¼ˆæœ€ã‚‚è¤‡é›‘ï¼‰

```
Field A (1000mÂ²):

4/1-6/30:
  - Rice: 500mÂ² (50%)
  - Tomato: 500mÂ² (50%)

7/1-9/30:
  - Rice: 300mÂ² (30%)  â† ç¶™ç¶šï¼ˆé¢ç©ç¸®å°ï¼‰
  - Tomato: 500mÂ² (50%) â† ç¶™ç¶š
  - Wheat: 200mÂ² (20%)  â† æ–°è¦è¿½åŠ 

10/1-12/31:
  - Wheat: 500mÂ² (50%)  â† ç¶™ç¶šï¼ˆé¢ç©æ‹¡å¤§ï¼‰
  - Lettuce: 500mÂ² (50%) â† æ–°è¦

ç‰¹å¾´:
  - æ™‚é–“ã¨ç©ºé–“ã®ä¸¡æ–¹ã§æœ€é©åŒ–
  - æœ€ã‚‚æŸ”è»Ÿ
  - æœ€ã‚‚è¤‡é›‘
```

---

## å®Ÿè£…æˆ¦ç•¥

### Strategy 1: æ™‚é–“åˆ†é›¢ã®ã¿ï¼ˆç¾çŠ¶ç¶­æŒï¼‰â˜… æ¨å¥¨ï¼ˆPhase 1ï¼‰

```python
# åŒã˜åœƒå ´ãƒ»åŒã˜æ™‚æœŸã«1ä½œç‰©ã®ã¿
# æ™‚é–“è»¸ã§åˆ†é›¢ã™ã‚‹ã“ã¨ã§è¤‡æ•°ä½œç‰©ã‚’æ ½åŸ¹

Field A:
  [â”€â”€â”€â”€â”€Riceâ”€â”€â”€â”€â”€][â”€â”€â”€â”€Tomatoâ”€â”€â”€â”€]
  4/1        8/31 9/1        12/31
  
å®Ÿè£…: ç¾åœ¨ã®è¨­è¨ˆã§å¯¾å¿œå¯èƒ½
å“è³ª: 85-95%
è¤‡é›‘åº¦: ä½
```

**æ¨å¥¨ç†ç”±**:
- âœ“ ã™ã§ã«å®Ÿè£…æ¸ˆã¿
- âœ“ ååˆ†ãªå“è³ª
- âœ“ å®Ÿè£…ãŒã‚·ãƒ³ãƒ—ãƒ«

---

### Strategy 2: é›¢æ•£çš„ãªç©ºé–“åˆ†å‰²ï¼ˆPhase 2ï¼‰ â˜… æ¨å¥¨

```python
# äº‹å‰å®šç¾©ã•ã‚ŒãŸæ¯”ç‡ãƒ‘ã‚¿ãƒ¼ãƒ³ã‹ã‚‰é¸æŠ
AREA_RATIO_PATTERNS = [
    {"rice": 1.0},                      # å˜ä½œ
    {"rice": 0.5, "tomato": 0.5},      # 50-50
    {"rice": 0.3, "tomato": 0.5, "wheat": 0.2},  # 30-50-20
    {"rice": 0.7, "tomato": 0.3},      # 70-30
    # ... 10-20ãƒ‘ã‚¿ãƒ¼ãƒ³
]

# å„åœƒå ´ãƒ»å„æ™‚æœŸã§æœ€è‰¯ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’é¸æŠ
for field in fields:
    for period in periods:
        best_pattern = None
        best_profit = 0
        
        for pattern in AREA_RATIO_PATTERNS:
            profit = calculate_profit(field, period, pattern)
            if profit > best_profit:
                best_pattern = pattern
                best_profit = profit
        
        # æœ€è‰¯ãƒ‘ã‚¿ãƒ¼ãƒ³ã§å€™è£œã‚’ç”Ÿæˆ
        for crop_id, ratio in best_pattern.items():
            area = field.area * ratio
            quantity = area / crop.area_per_unit
            candidates.append(Candidate(field, crop, period, quantity, area))
```

**å®Ÿè£…é›£æ˜“åº¦**: â˜…â˜…â˜†â˜†â˜†  
**åŠ¹æœ**: +3-5%  
**æ¨å¥¨**: â­â­â­â­â˜†

---

### Strategy 3: é€£ç¶šæœ€é©åŒ–ï¼ˆPhase 3ï¼‰

```python
from pulp import *

def optimize_continuous_ratios(field, crops, period):
    """é€£ç¶šçš„ãªé¢ç©æ¯”ç‡ã®æœ€é©åŒ–"""
    prob = LpProblem(f"AreaRatio_{field.field_id}", LpMaximize)
    
    # æ±ºå®šå¤‰æ•°: ratio[crop] âˆˆ [0, 1]
    ratios = {
        crop.crop_id: LpVariable(
            f"ratio_{crop.crop_id}", 
            lowBound=0, 
            upBound=1, 
            cat='Continuous'
        )
        for crop in crops
    }
    
    # åˆ¶ç´„: åˆè¨ˆ100%
    prob += lpSum(ratios.values()) == 1
    
    # ç›®çš„é–¢æ•°: åˆ©ç›Šæœ€å¤§åŒ–
    for crop in crops:
        quantity = (field.area * ratios[crop.crop_id]) / crop.area_per_unit
        revenue = quantity * crop.revenue_per_area * crop.area_per_unit
        cost_share = field.daily_fixed_cost * period.growth_days * ratios[crop.crop_id]
        prob += revenue - cost_share
    
    prob.solve()
    
    return {crop_id: var.varValue for crop_id, var in ratios.items()}
```

**å®Ÿè£…é›£æ˜“åº¦**: â˜…â˜…â˜…â˜…â˜†  
**åŠ¹æœ**: +5-10%  
**æ¨å¥¨**: â­â­â­â˜†â˜†ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

---

## å®Ÿè£…ã®å„ªå…ˆé †ä½

### Phase 1: æ™‚é–“åˆ†é›¢ã®ã¿ï¼ˆç¾çŠ¶ï¼‰

```
å®Ÿè£…: å®Œäº†æ¸ˆã¿ âœ“
å“è³ª: 85-95%
è¤‡é›‘åº¦: ä½

çµè«–: ã¾ãšã“ã‚Œã§ååˆ†
```

---

### Phase 2: é›¢æ•£ãƒ‘ã‚¿ãƒ¼ãƒ³è¿½åŠ 

```
å®Ÿè£…å·¥æ•°: 3-5æ—¥
å“è³ª: 88-96% (+3-5%)
è¤‡é›‘åº¦: ä¸­

ã‚¿ã‚¤ãƒŸãƒ³ã‚°: Fieldãƒ»Cropæœ€é©åŒ–ãŒå®Œæˆå¾Œ
å„ªå…ˆåº¦: â­â­â­â­â˜†ï¼ˆæ¨å¥¨ï¼‰
```

**å®Ÿè£…ã‚¤ãƒ¡ãƒ¼ã‚¸**:

```python
# å€™è£œç”Ÿæˆæ™‚ã«ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’è€ƒæ…®
def _generate_candidates_with_patterns(fields, crops, request):
    candidates = []
    
    for field in fields:
        # å˜ä½œå€™è£œ
        for crop in crops:
            candidates.append(create_single_crop_candidate(field, crop))
        
        # æ··æ¤å€™è£œï¼ˆ2ä½œç‰©ï¼‰
        for crop_a, crop_b in combinations(crops, 2):
            for ratio_a in [0.3, 0.5, 0.7]:
                ratio_b = 1.0 - ratio_a
                candidates.append(create_mixed_candidate(
                    field, 
                    [(crop_a, ratio_a), (crop_b, ratio_b)]
                ))
        
        # æ··æ¤å€™è£œï¼ˆ3ä½œç‰©ï¼‰- ã‚ªãƒ—ã‚·ãƒ§ãƒ³
        for crop_a, crop_b, crop_c in combinations(crops, 3):
            candidates.append(create_mixed_candidate(
                field,
                [(crop_a, 0.3), (crop_b, 0.5), (crop_c, 0.2)]
            ))
    
    return candidates
```

---

### Phase 3: é€£ç¶šæœ€é©åŒ–ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

```
å®Ÿè£…å·¥æ•°: 5-7æ—¥
å“è³ª: 90-98% (+2-5%)
è¤‡é›‘åº¦: é«˜

ã‚¿ã‚¤ãƒŸãƒ³ã‚°: å³å¯†è§£ãŒå¿…è¦ã«ãªã£ãŸæ™‚
å„ªå…ˆåº¦: â­â­â˜†â˜†â˜†ï¼ˆä½ï¼‰
```

---

## å•é¡Œã®è¤‡é›‘åº¦

### å€™è£œæ•°ã®çˆ†ç™º

```
ç¾çŠ¶ï¼ˆå˜ä½œã®ã¿ï¼‰:
  F Ã— C Ã— P = 10 Ã— 5 Ã— 5 = 250å€™è£œ

é›¢æ•£ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆ2ä½œç‰©æ··æ¤ï¼‰:
  å˜ä½œ: F Ã— C Ã— P = 250
  æ··æ¤: F Ã— C(C-1)/2 Ã— P Ã— 3ãƒ‘ã‚¿ãƒ¼ãƒ³ = 10 Ã— 10 Ã— 5 Ã— 3 = 1,500
  åˆè¨ˆ: 1,750å€™è£œ â† ç´„7å€

é›¢æ•£ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆ3ä½œç‰©æ··æ¤ã‚‚å«ã‚€ï¼‰:
  å˜ä½œ: 250
  2ä½œç‰©æ··æ¤: 1,500
  3ä½œç‰©æ··æ¤: F Ã— C(C-1)(C-2)/6 Ã— P = 10 Ã— 10 Ã— 5 = 500
  åˆè¨ˆ: 2,250å€™è£œ â† ç´„9å€
```

**çµè«–**: å€™è£œæ•°ãŒçˆ†ç™ºçš„ã«å¢—åŠ ã™ã‚‹ãŸã‚ã€æ…é‡ãªå®Ÿè£…ãŒå¿…è¦

---

## æ¨å¥¨å®Ÿè£…ãƒ—ãƒ©ãƒ³

### ğŸ“ ç¾çŠ¶ï¼ˆPhase 1ï¼‰

```
æ–¹é‡: æ™‚é–“åˆ†é›¢ã®ã¿
å®Ÿè£…: å®Œäº† âœ“
å“è³ª: 85-95%

çµè«–: ã¾ãšã“ã‚Œã§å®Ÿç”¨åŒ–
```

---

### ğŸ“ Phase 2ï¼ˆ2-3é€±é–“å¾Œï¼‰

```
æ–¹é‡: é›¢æ•£ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆé™å®šçš„ï¼‰
å®Ÿè£…å†…å®¹:
  1. 2ä½œç‰©æ··æ¤ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆ50-50ã®ã¿ï¼‰
  2. åˆ©ç›Šç‡ã®é«˜ã„çµ„ã¿åˆã‚ã›ã®ã¿
  3. å€™è£œæ•°ã‚’åˆ¶é™ï¼ˆÃ—2-3å€ç¨‹åº¦ã«æŠ‘ãˆã‚‹ï¼‰

æœŸå¾…åŠ¹æœ: +2-3%
å®Ÿè£…å·¥æ•°: 3-5æ—¥
```

**å®Ÿè£…ä¾‹**:

```python
# é™å®šçš„ãªæ··æ¤ãƒ‘ã‚¿ãƒ¼ãƒ³
def generate_limited_mixed_patterns(field, crops):
    """åˆ©ç›Šç‡ã®é«˜ã„çµ„ã¿åˆã‚ã›ã®ã¿ç”Ÿæˆ"""
    candidates = []
    
    # å˜ä½œï¼ˆå¿…é ˆï¼‰
    for crop in crops:
        candidates.append((field, [(crop, 1.0)]))
    
    # 2ä½œç‰©æ··æ¤ï¼ˆåˆ©ç›Šç‡ä¸Šä½3çµ„ã®ã¿ï¼‰
    crop_pairs = get_top_profitable_pairs(crops, top_k=3)
    for crop_a, crop_b in crop_pairs:
        # 50-50ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ã¿
        candidates.append((field, [(crop_a, 0.5), (crop_b, 0.5)]))
    
    return candidates

# å€™è£œæ•°: C + 3 = 5 + 3 = 8å€™è£œ/åœƒå ´
# å…¨ä½“: F Ã— 8 = 10 Ã— 8 = 80å€™è£œï¼ˆè¨±å®¹ç¯„å›²ï¼‰
```

---

### ğŸ“ Phase 3ï¼ˆå°†æ¥ï¼‰

```
æ–¹é‡: é€£ç¶šæœ€é©åŒ–ï¼ˆLPï¼‰
å®Ÿè£…: å³å¯†è§£ãŒå¿…è¦ã«ãªã£ãŸã‚‰
æœŸå¾…åŠ¹æœ: +3-5%
å®Ÿè£…å·¥æ•°: 5-7æ—¥
```

---

## ã¾ã¨ã‚

### è³ªå•ã¸ã®å›ç­”

**ã€Œåœƒå ´ã”ã¨ã®ä½œç‰©ã®ä½œä»˜é¢ç©ã®æ¯”ç‡ã¯å€‹åˆ¥ã«æœ€é©åŒ–ã§ãã‚‹ã‹ï¼Ÿã€**

**ç­”ãˆ: ã¯ã„ã€ã§ãã¾ã™ï¼**

ãŸã ã—ã€å®Ÿè£…æ–¹æ³•ã«ã‚ˆã£ã¦è¤‡é›‘åº¦ãŒç•°ãªã‚Šã¾ã™ï¼š

| Approach | å®Ÿè£…é›£æ˜“åº¦ | å“è³ª | æ¨å¥¨ |
|----------|-----------|------|------|
| **æ™‚é–“åˆ†é›¢** | ä½ | 85-95% | âœ… Phase 1 |
| **é›¢æ•£ãƒ‘ã‚¿ãƒ¼ãƒ³** | ä¸­ | 88-96% | âœ… Phase 2 |
| **é€£ç¶šæœ€é©åŒ–** | é«˜ | 90-98% | â–³ Phase 3 |

---

### æ¨å¥¨å®Ÿè£…é †åº

```
Week 1-3: æ™‚é–“åˆ†é›¢ï¼ˆç¾çŠ¶ç¶­æŒï¼‰
  â†’ Fieldãƒ»Crop ã®çµ„ã¿åˆã‚ã›æœ€é©åŒ–ã«é›†ä¸­

Week 4-5: é›¢æ•£ãƒ‘ã‚¿ãƒ¼ãƒ³è¿½åŠ 
  â†’ 2ä½œç‰©æ··æ¤ï¼ˆ50-50ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰ã®ã¿
  â†’ å€™è£œæ•°ã‚’åˆ¶é™

Week 6-: é€£ç¶šæœ€é©åŒ–ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
  â†’ å³å¯†ãªæœ€é©æ¯”ç‡ãŒå¿…è¦ãªå ´åˆ
```

---

### æ®µéšçš„ãªå“è³ªå‘ä¸Š

```
Phase 1: æ™‚é–“åˆ†é›¢ã®ã¿
  å“è³ª: 85-95%
  å®Ÿè£…: ç°¡å˜

Phase 2: + é›¢æ•£ãƒ‘ã‚¿ãƒ¼ãƒ³
  å“è³ª: 88-96% (+2-3%)
  å®Ÿè£…: ä¸­ç¨‹åº¦

Phase 3: + é€£ç¶šæœ€é©åŒ–
  å“è³ª: 90-98% (+2-3%)
  å®Ÿè£…: è¤‡é›‘
```

---

## çµè«–

### çŸ­æœŸçš„ãªæ¨å¥¨

**ç¾çŠ¶ã®æ™‚é–“åˆ†é›¢ã§ååˆ†** âœ“
- åŒã˜åœƒå ´ã§æ™‚æœŸã‚’ãšã‚‰ã—ã¦è¤‡æ•°ä½œç‰©ã‚’æ ½åŸ¹
- å®Ÿè£…æ¸ˆã¿
- å“è³ª85-95%ã§å®Ÿç”¨çš„

### ä¸­æœŸçš„ãªæ‹¡å¼µ

**é›¢æ•£ãƒ‘ã‚¿ãƒ¼ãƒ³ã®è¿½åŠ ** â­
- 50-50æ··æ¤ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’è¿½åŠ 
- å€™è£œæ•°ã‚’åˆ¶é™ã—ã¦å®Ÿè£…
- å“è³ª+2-3%å‘ä¸Š

### é•·æœŸçš„ãªã‚ªãƒ—ã‚·ãƒ§ãƒ³

**é€£ç¶šæœ€é©åŒ–ï¼ˆLPï¼‰**
- å³å¯†ãªæœ€é©æ¯”ç‡
- å¿…è¦ã«ãªã£ãŸã‚‰å®Ÿè£…

ã“ã®æ®µéšçš„ã‚¢ãƒ—ãƒ­ãƒ¼ãƒã«ã‚ˆã‚Šã€**æ—©æœŸã«ä¾¡å€¤ã‚’æä¾›ã—ãªãŒã‚‰ã€ç¶™ç¶šçš„ã«æ”¹å–„**ã§ãã¾ã™ï¼

